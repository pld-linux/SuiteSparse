--- SuiteSparse/Makefile.orig	2014-07-14 22:11:15.000000000 +0200
+++ SuiteSparse/Makefile	2023-01-04 06:22:56.515276025 +0100
@@ -6,9 +6,7 @@ include SuiteSparse_config/SuiteSparse_c
 
 # Compile the default rules for each package
 default:
-	( cd SuiteSparse_config/xerbla && $(MAKE) )
 	( cd SuiteSparse_config && $(MAKE) )
-	- ( cd metis-4.0 && $(MAKE) )
 	( cd AMD && $(MAKE) )
 	( cd CAMD && $(MAKE) )
 	( cd COLAMD && $(MAKE) )
--- SuiteSparse/SuiteSparse_config/Makefile.orig	2014-07-14 21:59:09.000000000 +0200
+++ SuiteSparse/SuiteSparse_config/Makefile	2023-01-03 21:39:35.228478223 +0100
@@ -8,17 +8,15 @@ default: ccode
 
 include SuiteSparse_config.mk
 
-ccode: libsuitesparseconfig.a
+ccode: libsuitesparseconfig.la
 
-all: libsuitesparseconfig.a
+all: libsuitesparseconfig.la
 
-library: libsuitesparseconfig.a
+library: libsuitesparseconfig.la
 
-libsuitesparseconfig.a: SuiteSparse_config.c SuiteSparse_config.h
-	$(CC) $(CF) -c SuiteSparse_config.c
-	$(ARCHIVE) libsuitesparseconfig.a SuiteSparse_config.o
-	$(RANLIB) libsuitesparseconfig.a
-	- $(RM) SuiteSparse_config.o
+libsuitesparseconfig.la: SuiteSparse_config.c SuiteSparse_config.h
+	libtool --mode=compile --tag=CC $(CC) $(CF) -c SuiteSparse_config.c
+	libtool --mode=link --tag=CC $(CC) $(LDFLAGS) $(CFLAGS) -o libsuitesparseconfig.la SuiteSparse_config.lo -lrt -lm -rpath $(INSTALL_LIB)
 
 distclean: purge
 
@@ -30,16 +28,14 @@ clean:
 
 # install SuiteSparse_config
 install:
-	$(CP) libsuitesparseconfig.a $(INSTALL_LIB)/libsuitesparseconfig.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libsuitesparseconfig.$(VERSION).a libsuitesparseconfig.a )
-	$(CP) SuiteSparse_config.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libsuitesparseconfig*.a
-	chmod 644 $(INSTALL_INCLUDE)/SuiteSparse_config.h
+	libtool --mode=install $(CP) libsuitesparseconfig.la $(DESTDIR)$(INSTALL_LIB)
+	$(CP) SuiteSparse_config.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparse_config.h
 
 # uninstall SuiteSparse_config
 uninstall:
-	$(RM) $(INSTALL_LIB)/libsuitesparseconfig*.a
-	$(RM) $(INSTALL_INCLUDE)/SuiteSparse_config.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libsuitesparseconfig.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparse_config.h
 
 dif:
 	- diff SuiteSparse_config.mk SuiteSparse_config_linux.mk
--- SuiteSparse/AMD/Demo/Makefile.orig	2023-01-04 20:55:29.531408884 +0100
+++ SuiteSparse/AMD/Demo/Makefile	2023-01-04 20:55:33.198055687 +0100
@@ -10,7 +10,7 @@ C = $(CC) $(CF) -I../Include -I../../Sui
 
 INC = ../Include/amd.h ../../SuiteSparse_config/SuiteSparse_config.h
 
-LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 library:
 	( cd ../../SuiteSparse_config ; $(MAKE) )
@@ -26,22 +26,22 @@ f77lib:
 dist:
 
 amd_demo: amd_demo.c library $(INC)
-	$(C) -o amd_demo amd_demo.c ../Lib/libamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o amd_demo amd_demo.c ../Lib/libamd.la $(LIB2)
 	./amd_demo > my_amd_demo.out
 	- diff amd_demo.out my_amd_demo.out
 
 amd_l_demo: amd_l_demo.c library $(INC)
-	$(C) -o amd_l_demo amd_l_demo.c ../Lib/libamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o amd_l_demo amd_l_demo.c ../Lib/libamd.la $(LIB2)
 	./amd_l_demo > my_amd_l_demo.out
 	- diff amd_l_demo.out my_amd_l_demo.out
 
 amd_demo2: amd_demo2.c library $(INC)
-	$(C) -o amd_demo2 amd_demo2.c ../Lib/libamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o amd_demo2 amd_demo2.c ../Lib/libamd.la $(LIB2)
 	./amd_demo2 > my_amd_demo2.out
 	- diff amd_demo2.out my_amd_demo2.out
 
 amd_simple: amd_simple.c library $(INC)
-	$(C) -o amd_simple amd_simple.c ../Lib/libamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o amd_simple amd_simple.c ../Lib/libamd.la $(LIB2)
 	./amd_simple > my_amd_simple.out
 	- diff amd_simple.out my_amd_simple.out
 
@@ -54,23 +54,23 @@ fortran: amd_f77demo amd_f77simple
 cross: amd_f77cross
 
 amd_f77demo: amd_f77demo.f f77lib
-	$(F77) $(F77FLAGS) -o amd_f77demo amd_f77demo.f ../Lib/libamdf77.a \
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o amd_f77demo amd_f77demo.f ../Lib/libamdf77.la \
 	    $(F77LIB)
 	./amd_f77demo > my_amd_f77demo.out
 	- diff amd_f77demo.out my_amd_f77demo.out
 
 amd_f77simple: amd_f77simple.f f77lib
-	$(F77) $(F77FLAGS) -o amd_f77simple amd_f77simple.f \
-	    ../Lib/libamdf77.a $(F77LIB)
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o amd_f77simple amd_f77simple.f \
+	    ../Lib/libamdf77.la $(F77LIB)
 	./amd_f77simple > my_amd_f77simple.out
 	- diff amd_f77simple.out my_amd_f77simple.out
 
 amd_f77wrapper.o: amd_f77wrapper.c
 	$(C) -DDINT -c amd_f77wrapper.c
 
-amd_f77cross:  amd_f77cross.f amd_f77wrapper.o ../Lib/libamd.a
-	$(F77) $(F77FLAGS) -o amd_f77cross amd_f77cross.f amd_f77wrapper.o \
-	    ../Lib/libamd.a $(F77LIB)
+amd_f77cross:  amd_f77cross.f amd_f77wrapper.o ../Lib/libamd.la
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o amd_f77cross amd_f77cross.f amd_f77wrapper.o \
+	    ../Lib/libamd.la $(F77LIB)
 	./amd_f77cross > my_amd_f77cross.out
 	- diff amd_f77cross.out my_amd_f77cross.out
 
--- SuiteSparse/AMD/Lib/GNUmakefile.orig	2014-03-21 20:22:00.000000000 +0100
+++ SuiteSparse/AMD/Lib/GNUmakefile	2023-01-04 21:04:10.698585479 +0100
@@ -2,7 +2,7 @@
 # AMD Makefile for compiling on Unix systems (for GNU make only)
 #-------------------------------------------------------------------------------
 
-default: libamd.a
+default: libamd.la
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
@@ -31,36 +31,42 @@ AMDL = $(addsuffix .o, $(subst amd_,amd_
 #-------------------------------------------------------------------------------
 
 amd_i_%.o: ../Source/amd_%.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 amd_l_%.o: ../Source/amd_%.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # Create the libamd.a library (C versions only)
 #-------------------------------------------------------------------------------
 
-libamd.a: $(AMDI) $(AMDL)
-	$(ARCHIVE) libamd.a $^
-	- $(RANLIB) libamd.a
+libamd.la: $(AMDI) $(AMDL)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libamd.la -rpath $(INSTALL_LIB) $(^:.o=.lo) ../../SuiteSparse_config/libsuitesparseconfig.la -lm
+
+install: libamd.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libamd.la $(DESTDIR)$(INSTALL_LIB)
 
 #-------------------------------------------------------------------------------
 # compile the Fortran versions and the libamdf77.a library
 #-------------------------------------------------------------------------------
 
-fortran: libamdf77.a
+fortran: libamdf77.la
 
 AMDF77 = amd.o amdbar.o
 
 amd.o: ../Source/amd.f
-	$(F77) $(F77FLAGS) -c ../Source/amd.f -o amd.o
+	libtool --tag=F77 --mode=compile $(F77) $(F77FLAGS) -c ../Source/amd.f -o amd.o
 
 amdbar.o: ../Source/amdbar.f
-	$(F77) $(F77FLAGS) -c ../Source/amdbar.f -o amdbar.o
+	libtool --tag=F77 --mode=compile $(F77) $(F77FLAGS) -c ../Source/amdbar.f -o amdbar.o
+
+libamdf77.la: $(AMDF77)
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) -o libamdf77.la -rpath $(INSTALL_LIB) $(^:.o=.lo) -lm
 
-libamdf77.a: $(AMDF77)
-	$(ARCHIVE) libamdf77.a $^
-	- $(RANLIB) libamdf77.a
+install-fortran: libamdf77.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libamdf77.la $(DESTDIR)$(INSTALL_LIB)
 
 #-------------------------------------------------------------------------------
 # Remove all but the files in the original distribution
@@ -72,4 +78,4 @@ clean:
 purge: distclean
 
 distclean: clean
-	- $(RM) libamd.a libamdf77.a
+	- $(RM) libamd.la libamdf77.la
--- SuiteSparse/AMD/Makefile.orig	2014-03-21 20:22:00.000000000 +0100
+++ SuiteSparse/AMD/Makefile	2023-01-05 21:37:59.756190823 +0100
@@ -60,14 +60,12 @@ lib: library
 
 # install AMD
 install:
-	$(CP) Lib/libamd.a $(INSTALL_LIB)/libamd.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libamd.$(VERSION).a libamd.a )
-	$(CP) Include/amd.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libamd*
-	chmod 644 $(INSTALL_INCLUDE)/amd.h
+	$(MAKE) -C Lib install install-fortran
+	$(CP) Include/amd.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/amd.h
 
 # uninstall AMD
 uninstall:
-	$(RM) $(INSTALL_LIB)/libamd*.a
-	$(RM) $(INSTALL_INCLUDE)/amd.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libamd.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/amd.h
 
--- SuiteSparse/BTF/Lib/Makefile.orig	2014-03-21 20:13:35.000000000 +0100
+++ SuiteSparse/BTF/Lib/Makefile	2023-01-05 21:57:21.606563206 +0100
@@ -15,45 +15,48 @@ I = -I../Include -I../../SuiteSparse_con
 
 all: library
 
-library: libbtf.a
+library: libbtf.la
 
 OBJ = btf_order.o btf_maxtrans.o btf_strongcomp.o \
     btf_l_order.o btf_l_maxtrans.o btf_l_strongcomp.o
 
-libbtf.a: $(OBJ)
-	$(ARCHIVE)  libbtf.a $(OBJ)
-	- $(RANLIB) libbtf.a
+libbtf.la: $(OBJ)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CFLAGS) -o libbtf.la -rpath $(INSTALL_LIB) $(OBJ:.o=.lo)
+
+install: libbtf.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libbtf.la $(DESTDIR)$(INSTALL_LIB)/libbtf.la
 
 $(OBJ): $(INC)
 
 #-------------------------------------------------------------------------------
 
 btf_order.o: ../Source/btf_order.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 btf_maxtrans.o: ../Source/btf_maxtrans.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 btf_strongcomp.o: ../Source/btf_strongcomp.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 
 btf_l_order.o: ../Source/btf_order.c
-	$(C) -c $(I) -DDLONG $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) -DDLONG $< -o $@
 
 btf_l_maxtrans.o: ../Source/btf_maxtrans.c
-	$(C) -c $(I) -DDLONG $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) -DDLONG $< -o $@
 
 btf_l_strongcomp.o: ../Source/btf_strongcomp.c
-	$(C) -c $(I) -DDLONG $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) -DDLONG $< -o $@
 
 #-------------------------------------------------------------------------------
 
 purge: distclean
 
 distclean: clean
-	- $(RM) libbtf.a 
+	- $(RM) libbtf.la 
 
 clean:
 	- $(RM) $(CLEAN)
--- SuiteSparse/BTF/Makefile.orig	2014-03-21 20:13:35.000000000 +0100
+++ SuiteSparse/BTF/Makefile	2023-01-05 22:00:16.658948199 +0100
@@ -23,14 +23,12 @@ purge: distclean
 
 # install BTF
 install:
-	$(CP) Lib/libbtf.a $(INSTALL_LIB)/libbtf.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libbtf.$(VERSION).a libbtf.a )
-	$(CP) Include/btf.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libbtf*.a
-	chmod 644 $(INSTALL_INCLUDE)/btf.h
+	$(MAKE) -C Lib install
+	$(CP) Include/btf.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/btf.h
 
 # uninstall BTF
 uninstall:
-	$(RM) $(INSTALL_LIB)/libbtf*.a
-	$(RM) $(INSTALL_INCLUDE)/btf.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libbtf.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/btf.h
 
--- SuiteSparse/CAMD/Demo/Makefile.orig	2023-01-07 11:33:29.849877149 +0100
+++ SuiteSparse/CAMD/Demo/Makefile	2023-01-07 11:33:34.133187277 +0100
@@ -10,7 +10,7 @@ C = $(CC) $(CF) -I../Include -I../../Sui
 
 INC = ../Include/camd.h ../../SuiteSparse_config/SuiteSparse_config.h
 
-LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 library:
 	( cd ../../SuiteSparse_config ; $(MAKE) )
@@ -23,22 +23,22 @@ library:
 dist:
 
 camd_demo: camd_demo.c library $(INC)
-	$(C) -o camd_demo camd_demo.c ../Lib/libcamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o camd_demo camd_demo.c ../Lib/libcamd.la $(LIB2)
 	./camd_demo > my_camd_demo.out
 	- diff camd_demo.out my_camd_demo.out
 
 camd_l_demo: camd_l_demo.c library $(INC)
-	$(C) -o camd_l_demo camd_l_demo.c ../Lib/libcamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o camd_l_demo camd_l_demo.c ../Lib/libcamd.la $(LIB2)
 	./camd_l_demo > my_camd_l_demo.out
 	- diff camd_l_demo.out my_camd_l_demo.out
 
 camd_demo2: camd_demo2.c library $(INC)
-	$(C) -o camd_demo2 camd_demo2.c ../Lib/libcamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o camd_demo2 camd_demo2.c ../Lib/libcamd.la $(LIB2)
 	./camd_demo2 > my_camd_demo2.out
 	- diff camd_demo2.out my_camd_demo2.out
 
 camd_simple: camd_simple.c library $(INC)
-	$(C) -o camd_simple camd_simple.c ../Lib/libcamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o camd_simple camd_simple.c ../Lib/libcamd.la $(LIB2)
 	./camd_simple > my_camd_simple.out
 	- diff camd_simple.out my_camd_simple.out
 
--- SuiteSparse/CAMD/Lib/GNUmakefile.orig	2014-03-21 20:21:52.000000000 +0100
+++ SuiteSparse/CAMD/Lib/GNUmakefile	2023-01-08 15:11:41.817549574 +0100
@@ -2,7 +2,7 @@
 # CAMD Makefile for compiling on Unix systems (for GNU make only)
 #-------------------------------------------------------------------------------
 
-default: libcamd.a
+default: libcamd.la
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
@@ -30,18 +30,21 @@ CAMDL = $(addsuffix .o, $(subst camd_,ca
 #-------------------------------------------------------------------------------
 
 camd_i_%.o: ../Source/camd_%.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 camd_l_%.o: ../Source/camd_%.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # Create the libcamd.a library (C versions only)
 #-------------------------------------------------------------------------------
 
-libcamd.a: $(CAMDI) $(CAMDL)
-	$(ARCHIVE)  libcamd.a $^
-	- $(RANLIB) libcamd.a
+libcamd.la: $(CAMDI) $(CAMDL)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libcamd.la -rpath $(INSTALL_LIB) $(^:.o=.lo) ../../SuiteSparse_config/libsuitesparseconfig.la -lm
+
+install: libcamd.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libcamd.la $(DESTDIR)$(INSTALL_LIB)
 
 #-------------------------------------------------------------------------------
 # Remove all but the files in the original distribution
@@ -53,4 +56,4 @@ clean:
 purge: distclean
 
 distclean: clean
-	- $(RM) libcamd.a
+	- $(RM) libcamd.la
--- SuiteSparse/CAMD/Makefile.orig	2014-03-21 20:21:53.000000000 +0100
+++ SuiteSparse/CAMD/Makefile	2023-01-07 14:00:18.652155770 +0100
@@ -50,14 +50,12 @@ lib: library
 
 # install CAMD
 install:
-	$(CP) Lib/libcamd.a $(INSTALL_LIB)/libcamd.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libcamd.$(VERSION).a libcamd.a )
-	$(CP) Include/camd.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libcamd*.a
-	chmod 644 $(INSTALL_INCLUDE)/camd.h
+	$(MAKE) -C Lib install
+	$(CP) Include/camd.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/camd.h
 
 # uninstall CAMD
 uninstall:
-	$(RM) $(INSTALL_LIB)/libcamd*.a
-	$(RM) $(INSTALL_INCLUDE)/camd.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libcamd.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/camd.h
 
--- SuiteSparse/CCOLAMD/Demo/Makefile.orig	2014-03-21 20:21:07.000000000 +0100
+++ SuiteSparse/CCOLAMD/Demo/Makefile	2023-01-07 15:03:18.638344494 +0100
@@ -10,7 +10,7 @@ I = -I../Include -I../../SuiteSparse_con
 
 C = $(CC) $(CF) $(I)
 
-LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 library:
 	( cd ../../SuiteSparse_config ; $(MAKE) )
@@ -23,12 +23,12 @@ library:
 dist:
 
 ccolamd_example: ccolamd_example.c library
-	$(C) -o ccolamd_example ccolamd_example.c ../Lib/libccolamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o ccolamd_example ccolamd_example.c ../Lib/libccolamd.la $(LIB2)
 	- ./ccolamd_example > my_ccolamd_example.out
 	- diff ccolamd_example.out my_ccolamd_example.out
 
 ccolamd_l_example: ccolamd_l_example.c library
-	$(C) -o ccolamd_l_example ccolamd_l_example.c ../Lib/libccolamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o ccolamd_l_example ccolamd_l_example.c ../Lib/libccolamd.la $(LIB2)
 	- ./ccolamd_l_example > my_ccolamd_l_example.out
 	- diff ccolamd_l_example.out my_ccolamd_l_example.out
 
--- SuiteSparse/CCOLAMD/Lib/Makefile.orig	2014-03-21 20:21:07.000000000 +0100
+++ SuiteSparse/CCOLAMD/Lib/Makefile	2023-01-07 16:00:17.693155217 +0100
@@ -2,7 +2,7 @@
 # CCOLAMD Makefile
 #-------------------------------------------------------------------------------
 
-default: libccolamd.a
+default: libccolamd.la
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
@@ -13,15 +13,18 @@ INC = ../Include/ccolamd.h ../../SuiteSp
 SRC = ../Source/ccolamd.c
 
 # creates libccolamd.a, a C-callable COLAMD library
-libccolamd.a:  $(SRC) $(INC)
-	$(CC) $(CF) $(I) -c ../Source/ccolamd.c
-	$(CC) $(CF) $(I) -c ../Source/ccolamd.c -DDLONG -o ccolamd_l.o
-	$(ARCHIVE)  libccolamd.a ccolamd.o ccolamd_l.o
-	- $(RANLIB) libccolamd.a 
+libccolamd.la:  $(SRC) $(INC)
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c ../Source/ccolamd.c
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c ../Source/ccolamd.c -DDLONG -o ccolamd_l.o
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CFLAGS) -o libccolamd.la -rpath $(INSTALL_LIB) ccolamd.lo ccolamd_l.lo ../../SuiteSparse_config/libsuitesparseconfig.la -lm
 
-ccode: libccolamd.a
+install: libccolamd.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libccolamd.la $(DESTDIR)$(INSTALL_LIB)
 
-library: libccolamd.a
+ccode: libccolamd.la
+
+library: libccolamd.la
 
 clean:
 	- $(RM) $(CLEAN)
@@ -29,4 +32,4 @@ clean:
 purge: distclean
 
 distclean: clean
-	- $(RM) libccolamd.a
+	- $(RM) libccolamd.la
--- SuiteSparse/CCOLAMD/Makefile.orig	2014-03-21 20:21:08.000000000 +0100
+++ SuiteSparse/CCOLAMD/Makefile	2023-01-07 16:01:00.286257804 +0100
@@ -43,14 +43,12 @@ lib: library
 
 # install CCOLAMD
 install:
-	$(CP) Lib/libccolamd.a $(INSTALL_LIB)/libccolamd.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libccolamd.$(VERSION).a libccolamd.a )
-	$(CP) Include/ccolamd.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libccolamd*.a
-	chmod 644 $(INSTALL_INCLUDE)/ccolamd.h
+	$(MAKE) -C Lib install
+	$(CP) Include/ccolamd.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/ccolamd.h
 
 # uninstall CCOLAMD
 uninstall:
-	$(RM) $(INSTALL_LIB)/libccolamd*.a
-	$(RM) $(INSTALL_INCLUDE)/ccolamd.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libccolamd.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/ccolamd.h
 
--- SuiteSparse/COLAMD/Demo/Makefile.orig	2014-03-21 20:13:38.000000000 +0100
+++ SuiteSparse/COLAMD/Demo/Makefile	2023-01-07 16:13:12.675623443 +0100
@@ -10,7 +10,7 @@ I = -I../Include -I../../SuiteSparse_con
 
 C = $(CC) $(CF) $(I)
 
-LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 library:
 	( cd ../../SuiteSparse_config ; $(MAKE) )
@@ -23,12 +23,12 @@ library:
 dist:
 
 colamd_example: colamd_example.c library
-	$(C) -o colamd_example colamd_example.c ../Lib/libcolamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o colamd_example colamd_example.c ../Lib/libcolamd.la $(LIB2)
 	- ./colamd_example > my_colamd_example.out
 	- diff colamd_example.out my_colamd_example.out
 
 colamd_l_example: colamd_l_example.c library
-	$(C) -o colamd_l_example colamd_l_example.c ../Lib/libcolamd.a $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o colamd_l_example colamd_l_example.c ../Lib/libcolamd.la $(LIB2)
 	- ./colamd_l_example > my_colamd_l_example.out
 	- diff colamd_l_example.out my_colamd_l_example.out
 
--- SuiteSparse/COLAMD/Lib/Makefile.orig	2014-03-21 20:13:38.000000000 +0100
+++ SuiteSparse/COLAMD/Lib/Makefile	2023-01-07 16:15:27.284894202 +0100
@@ -2,7 +2,7 @@
 # COLAMD Makefile
 #-------------------------------------------------------------------------------
 
-default: libcolamd.a
+default: libcolamd.la
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
@@ -13,15 +13,18 @@ INC = ../Include/colamd.h ../../SuiteSpa
 SRC = ../Source/colamd.c
 
 # creates libcolamd.a, a C-callable COLAMD library
-libcolamd.a:  $(SRC) $(INC)
-	$(CC) $(CF) $(I) -c ../Source/colamd.c
-	$(CC) $(CF) $(I) -c ../Source/colamd.c -DDLONG -o colamd_l.o
-	$(ARCHIVE)  libcolamd.a colamd.o colamd_l.o
-	- $(RANLIB) libcolamd.a
+libcolamd.la:  $(SRC) $(INC)
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c ../Source/colamd.c
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c ../Source/colamd.c -DDLONG -o colamd_l.o
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CFLAGS) -o libcolamd.la -rpath $(INSTALL_LIB) colamd.lo colamd_l.lo ../../SuiteSparse_config/libsuitesparseconfig.la -lm
+
+install: libcolamd.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libcolamd.la $(DESTDIR)$(INSTALL_LIB)
+ 
+ccode: libcolamd.la
 
-ccode: libcolamd.a
-
-library: libcolamd.a
+library: libcolamd.la
 
 clean:
 	- $(RM) $(CLEAN)
@@ -29,4 +32,4 @@ clean:
 purge: distclean
 
 distclean: clean
-	- $(RM) libcolamd.a
+	- $(RM) libcolamd.la
--- SuiteSparse/COLAMD/Makefile.orig	2014-03-21 20:13:39.000000000 +0100
+++ SuiteSparse/COLAMD/Makefile	2023-01-07 16:17:16.164304352 +0100
@@ -43,14 +43,12 @@ lib: library
 
 # install COLAMD
 install:
-	$(CP) Lib/libcolamd.a $(INSTALL_LIB)/libcolamd.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libcolamd.$(VERSION).a libcolamd.a )
-	$(CP) Include/colamd.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libcolamd*.a
-	chmod 644 $(INSTALL_INCLUDE)/colamd.h
+	$(MAKE) -C Lib install
+	$(CP) Include/colamd.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/colamd.h
 
 # uninstall COLAMD
 uninstall:
-	$(RM) $(INSTALL_LIB)/libcolamd*.a
-	$(RM) $(INSTALL_INCLUDE)/colamd.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libcolamd.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/colamd.h
 
--- SuiteSparse/CHOLMOD/Demo/Makefile.orig	2014-07-15 00:04:45.000000000 +0200
+++ SuiteSparse/CHOLMOD/Demo/Makefile	2023-01-07 17:28:50.357707376 +0100
@@ -22,7 +22,7 @@ ifeq (,$(findstring -DNCAMD, $(CHOLMOD_C
         ifeq (../../CCOLAMD, $(wildcard ../../CCOLAMD))
             # CAMD and CCOLAMD are requested and available
             LIB_WITH_PARTITION = \
-                        ../../CCOLAMD/Lib/libccolamd.a ../../CAMD/Lib/libcamd.a
+                        ../../CCOLAMD/Lib/libccolamd.la ../../CAMD/Lib/libcamd.la
             I_WITH_PARTITION = \
                         -I../../CCOLAMD/Include -I../../CAMD/Include
             CONFIG = -DNPARTITION
@@ -32,8 +32,8 @@ ifeq (,$(findstring -DNCAMD, $(CHOLMOD_C
                 ifeq ($(METIS_PATH), $(wildcard $(METIS_PATH)))
                     # METIS is available
                     LIB_WITH_PARTITION = $(METIS) \
-                        ../../CCOLAMD/Lib/libccolamd.a ../../CAMD/Lib/libcamd.a
-                    I_WITH_PARTITION = -I$(METIS_PATH)/Lib \
+                        ../../CCOLAMD/Lib/libccolamd.la ../../CAMD/Lib/libcamd.la
+                    I_WITH_PARTITION = -I$(METIS_PATH) \
                         -I../../CCOLAMD/Include -I../../CAMD/Include
                     CONFIG =
                 endif
@@ -44,8 +44,8 @@ endif
 
 #-------------------------------------------------------------------------------
 
-LIB2 = ../Lib/libcholmod.a ../../AMD/Lib/libamd.a ../../COLAMD/Lib/libcolamd.a \
-        ../../SuiteSparse_config/libsuitesparseconfig.a \
+LIB2 = ../Lib/libcholmod.la ../../AMD/Lib/libamd.la ../../COLAMD/Lib/libcolamd.la \
+        ../../SuiteSparse_config/libsuitesparseconfig.la \
 	$(LIB_WITH_PARTITION) $(LAPACK) $(BLAS) $(XERBLA) $(LIB)
 
 #-------------------------------------------------------------------------------
@@ -92,7 +92,6 @@ clean:
 #-------------------------------------------------------------------------------
 # See below if you compile with -DNPARTITION
 library:
-	( cd ../../SuiteSparse_config/xerbla ; $(MAKE) )
 	( cd ../../SuiteSparse_config ; $(MAKE) )
 	( cd ../Lib ; $(MAKE) )
 	( cd ../../AMD ; $(MAKE) library )
@@ -102,29 +101,25 @@ else
 	( cd ../../CCOLAMD ; $(MAKE) library )
 	( cd ../../CAMD ; $(MAKE) library )
 endif
-ifneq (,$(findstring -DNPARTITION, $(CONFIG)))
-else
-	( cd $(METIS_PATH) && $(MAKE) )
-endif
 
 #-------------------------------------------------------------------------------
 
 I = -I../Include -I../../SuiteSparse_config
 
 cholmod_demo: library cholmod_demo.c cholmod_demo.h
-	$(C) -o cholmod_demo $(I) cholmod_demo.c $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o cholmod_demo $(I) cholmod_demo.c $(LIB2)
 
 cholmod_simple: library cholmod_simple.c
-	$(C) -o cholmod_simple $(I) cholmod_simple.c $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o cholmod_simple $(I) cholmod_simple.c $(LIB2)
 
 cholmod_l_demo: library cholmod_l_demo.c cholmod_demo.h
-	$(C) -o cholmod_l_demo $(I) cholmod_l_demo.c $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o cholmod_l_demo $(I) cholmod_l_demo.c $(LIB2)
 
 readhb: readhb.f
-	$(F77) $(FFLAGS) -o readhb readhb.f
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(FFLAGS) -o readhb readhb.f
 
 readhb2: readhb2.f
-	$(F77) $(FFLAGS) -O -o readhb2 readhb2.f
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(FFLAGS) -O -o readhb2 readhb2.f
 
 reade: reade.f
-	$(F77) $(FFLAGS) -O -o reade reade.f
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(FFLAGS) -O -o reade reade.f
--- SuiteSparse/CHOLMOD/Lib/Makefile.orig	2014-03-23 01:46:29.000000000 +0100
+++ SuiteSparse/CHOLMOD/Lib/Makefile	2023-01-07 17:56:47.118623582 +0100
@@ -21,7 +21,7 @@ ifeq (,$(findstring -DNCAMD, $(CHOLMOD_C
         ifeq (../../CCOLAMD, $(wildcard ../../CCOLAMD))
             # CAMD and CCOLAMD are requested and available
             LIB_WITH_PARTITION = \
-                        ../../CCOLAMD/Lib/libccolamd.a ../../CAMD/Lib/libcamd.a
+                        ../../CCOLAMD/Lib/libccolamd.la ../../CAMD/Lib/libcamd.la
             I_WITH_PARTITION = \
                         -I../../CCOLAMD/Include -I../../CAMD/Include
             CONFIG = -DNPARTITION
@@ -31,8 +31,8 @@ ifeq (,$(findstring -DNCAMD, $(CHOLMOD_C
                 ifeq ($(METIS_PATH), $(wildcard $(METIS_PATH)))
                     # METIS is available
                     LIB_WITH_PARTITION = $(METIS) \
-                        ../../CCOLAMD/Lib/libccolamd.a ../../CAMD/Lib/libcamd.a
-                    I_WITH_PARTITION = -I$(METIS_PATH)/Lib \
+                        ../../CCOLAMD/Lib/libccolamd.la ../../CAMD/Lib/libcamd.la
+                    I_WITH_PARTITION = -I$(METIS_PATH) \
                         -I../../CCOLAMD/Include -I../../CAMD/Include
                     CONFIG =
                 endif
@@ -50,14 +50,14 @@ I = -I../../AMD/Include -I../../AMD/Sour
 
 C = $(CC) $(CF) $(CHOLMOD_CONFIG) $(CONFIG)
 
-all: libcholmod.a
+all: libcholmod.la
 
-library: libcholmod.a
+library: libcholmod.la
 
 purge: distclean
 
 distclean: clean
-	- $(RM) libcholmod.a
+	- $(RM) libcholmod.la
 
 clean:
 	- $(RM) $(CLEAN)
@@ -156,9 +156,13 @@ DL = $(LCORE) $(LCHECK) $(LCHOLESKY) $(L
 # to compile just the double/int version, use OBJ = $(DI)
 OBJ = $(DI) $(DL)
 
-libcholmod.a: $(OBJ)
-	$(ARCHIVE)  libcholmod.a $(OBJ)
-	- $(RANLIB) libcholmod.a
+libcholmod.la: $(OBJ)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libcholmod.la -rpath $(INSTALL_LIB) $(OBJ:.o=.lo) -lm \
+		../../AMD/Lib/libamd.la ../../COLAMD/Lib/libcolamd.la ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB_WITH_PARTITION) $(LAPACK) $(BLAS)
+
+install: libcholmod.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libcholmod.la $(DESTDIR)$(INSTALL_LIB)/libcholmod.la
 
 $(OBJ): $(INC)
 
@@ -167,24 +171,24 @@ $(OBJ): $(INC)
 #-------------------------------------------------------------------------------
 
 cholmod_check.o: ../Check/cholmod_check.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_read.o: ../Check/cholmod_read.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_write.o: ../Check/cholmod_write.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_check.o: ../Check/cholmod_check.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_read.o: ../Check/cholmod_read.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_write.o: ../Check/cholmod_write.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 
 #-------------------------------------------------------------------------------
@@ -192,98 +196,98 @@ cholmod_l_write.o: ../Check/cholmod_writ
 #-------------------------------------------------------------------------------
 
 cholmod_common.o: ../Core/cholmod_common.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_dense.o: ../Core/cholmod_dense.c ../Core/t_cholmod_dense.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_factor.o: ../Core/cholmod_factor.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_change_factor.o: ../Core/cholmod_change_factor.c \
 	../Core/t_cholmod_change_factor.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_memory.o: ../Core/cholmod_memory.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_sparse.o: ../Core/cholmod_sparse.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_complex.o: ../Core/cholmod_complex.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_transpose.o: ../Core/cholmod_transpose.c ../Core/t_cholmod_transpose.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_band.o: ../Core/cholmod_band.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_copy.o: ../Core/cholmod_copy.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_triplet.o: ../Core/cholmod_triplet.c ../Core/t_cholmod_triplet.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_error.o: ../Core/cholmod_error.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_aat.o: ../Core/cholmod_aat.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_add.o: ../Core/cholmod_add.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_version.o: ../Core/cholmod_version.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_common.o: ../Core/cholmod_common.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_dense.o: ../Core/cholmod_dense.c ../Core/t_cholmod_dense.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_factor.o: ../Core/cholmod_factor.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_change_factor.o: ../Core/cholmod_change_factor.c \
 	../Core/t_cholmod_change_factor.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_memory.o: ../Core/cholmod_memory.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_sparse.o: ../Core/cholmod_sparse.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_complex.o: ../Core/cholmod_complex.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_transpose.o: ../Core/cholmod_transpose.c ../Core/t_cholmod_transpose.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_band.o: ../Core/cholmod_band.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_copy.o: ../Core/cholmod_copy.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_triplet.o: ../Core/cholmod_triplet.c ../Core/t_cholmod_triplet.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_error.o: ../Core/cholmod_error.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_aat.o: ../Core/cholmod_aat.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_add.o: ../Core/cholmod_add.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_version.o: ../Core/cholmod_version.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 
 #-------------------------------------------------------------------------------
@@ -291,116 +295,116 @@ cholmod_l_version.o: ../Core/cholmod_ver
 #-------------------------------------------------------------------------------
 
 cholmod_amd.o: ../Cholesky/cholmod_amd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_analyze.o: ../Cholesky/cholmod_analyze.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_colamd.o: ../Cholesky/cholmod_colamd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_etree.o: ../Cholesky/cholmod_etree.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_factorize.o: ../Cholesky/cholmod_factorize.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_postorder.o: ../Cholesky/cholmod_postorder.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_rcond.o: ../Cholesky/cholmod_rcond.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_resymbol.o: ../Cholesky/cholmod_resymbol.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_rowcolcounts.o: ../Cholesky/cholmod_rowcolcounts.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_solve.o: ../Cholesky/cholmod_solve.c ../Cholesky/t_cholmod_lsolve.c \
 	../Cholesky/t_cholmod_ltsolve.c ../Cholesky/t_cholmod_solve.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_spsolve.o: ../Cholesky/cholmod_spsolve.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_rowfac.o: ../Cholesky/cholmod_rowfac.c ../Cholesky/t_cholmod_rowfac.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_amd.o: ../Cholesky/cholmod_amd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_analyze.o: ../Cholesky/cholmod_analyze.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_colamd.o: ../Cholesky/cholmod_colamd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_etree.o: ../Cholesky/cholmod_etree.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_factorize.o: ../Cholesky/cholmod_factorize.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_postorder.o: ../Cholesky/cholmod_postorder.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_rcond.o: ../Cholesky/cholmod_rcond.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_resymbol.o: ../Cholesky/cholmod_resymbol.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_rowcolcounts.o: ../Cholesky/cholmod_rowcolcounts.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_solve.o: ../Cholesky/cholmod_solve.c ../Cholesky/t_cholmod_lsolve.c \
 	../Cholesky/t_cholmod_ltsolve.c ../Cholesky/t_cholmod_solve.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_spsolve.o: ../Cholesky/cholmod_spsolve.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_rowfac.o: ../Cholesky/cholmod_rowfac.c ../Cholesky/t_cholmod_rowfac.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 # Partition Module:
 #-------------------------------------------------------------------------------
 
 cholmod_ccolamd.o: ../Partition/cholmod_ccolamd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_csymamd.o: ../Partition/cholmod_csymamd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_camd.o: ../Partition/cholmod_camd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_metis.o: ../Partition/cholmod_metis.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_nesdis.o: ../Partition/cholmod_nesdis.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_ccolamd.o: ../Partition/cholmod_ccolamd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_csymamd.o: ../Partition/cholmod_csymamd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_camd.o: ../Partition/cholmod_camd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_metis.o: ../Partition/cholmod_metis.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_nesdis.o: ../Partition/cholmod_nesdis.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 
 #-------------------------------------------------------------------------------
@@ -408,88 +412,88 @@ cholmod_l_nesdis.o: ../Partition/cholmod
 #-------------------------------------------------------------------------------
 
 cholmod_horzcat.o: ../MatrixOps/cholmod_horzcat.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_norm.o: ../MatrixOps/cholmod_norm.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_scale.o: ../MatrixOps/cholmod_scale.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_drop.o: ../MatrixOps/cholmod_drop.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_sdmult.o: ../MatrixOps/cholmod_sdmult.c \
 	../MatrixOps/t_cholmod_sdmult.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_ssmult.o: ../MatrixOps/cholmod_ssmult.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_submatrix.o: ../MatrixOps/cholmod_submatrix.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_vertcat.o: ../MatrixOps/cholmod_vertcat.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_symmetry.o: ../MatrixOps/cholmod_symmetry.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_horzcat.o: ../MatrixOps/cholmod_horzcat.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_norm.o: ../MatrixOps/cholmod_norm.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_scale.o: ../MatrixOps/cholmod_scale.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_drop.o: ../MatrixOps/cholmod_drop.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_sdmult.o: ../MatrixOps/cholmod_sdmult.c \
 	../MatrixOps/t_cholmod_sdmult.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_ssmult.o: ../MatrixOps/cholmod_ssmult.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_submatrix.o: ../MatrixOps/cholmod_submatrix.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_vertcat.o: ../MatrixOps/cholmod_vertcat.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_symmetry.o: ../MatrixOps/cholmod_symmetry.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 # Modify Module:
 #-------------------------------------------------------------------------------
 
 cholmod_rowadd.o: ../Modify/cholmod_rowadd.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_rowdel.o: ../Modify/cholmod_rowdel.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_updown.o: ../Modify/cholmod_updown.c \
 	../Modify/t_cholmod_updown.c ../Modify/t_cholmod_updown_numkr.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_rowadd.o: ../Modify/cholmod_rowadd.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_rowdel.o: ../Modify/cholmod_rowdel.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_updown.o: ../Modify/cholmod_updown.c \
 	../Modify/t_cholmod_updown.c ../Modify/t_cholmod_updown_numkr.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 
 #-------------------------------------------------------------------------------
@@ -499,27 +503,27 @@ cholmod_l_updown.o: ../Modify/cholmod_up
 cholmod_super_numeric.o: ../Supernodal/cholmod_super_numeric.c \
         ../GPU/t_cholmod_gpu.c \
 	../Supernodal/t_cholmod_super_numeric.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_super_symbolic.o: ../Supernodal/cholmod_super_symbolic.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_super_solve.o: ../Supernodal/cholmod_super_solve.c \
 	../Supernodal/t_cholmod_super_solve.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 #-------------------------------------------------------------------------------
 
 cholmod_l_super_numeric.o: ../Supernodal/cholmod_super_numeric.c \
 	../Supernodal/t_cholmod_super_numeric.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_super_symbolic.o: ../Supernodal/cholmod_super_symbolic.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 cholmod_l_super_solve.o: ../Supernodal/cholmod_super_solve.c \
 	../Supernodal/t_cholmod_super_solve.c
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 # GPU module
@@ -532,12 +536,12 @@ cholmod_l_super_solve.o: ../Supernodal/c
 
 cholmod_gpu_kernels.o: ../GPU/cholmod_gpu_kernels.c \
         ../GPU/cholmod_gpu_kernels.cu
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 	$(NVCC) -I../../SuiteSparse_config -Xcompiler -fPIC -O3  -gencode=arch=compute_20,code=sm_20 -gencode=arch=compute_30,code=sm_30 -gencode=arch=compute_35,code=sm_35 -c ../GPU/cholmod_gpu_kernels.cu
 
 cholmod_gpu.o: ../GPU/cholmod_gpu.c 
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 cholmod_l_gpu.o: ../GPU/cholmod_gpu.c 
-	$(C) -DDLONG -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $(I) $< -o $@
 
--- SuiteSparse/CHOLMOD/Tcov/Makefile.orig	2014-03-25 04:57:38.000000000 +0100
+++ SuiteSparse/CHOLMOD/Tcov/Makefile	2023-01-07 18:03:47.209681087 +0100
@@ -46,7 +46,7 @@ endif
 #-------------------------------------------------------------------------------
 
 I = -I../../AMD/Include -I../../COLAMD/Include \
-	-I$(METIS_PATH)/Lib -I../../CCOLAMD/Include -I../../CAMD/Include \
+	-I$(METIS_PATH) -I../../CCOLAMD/Include -I../../CAMD/Include \
 	-I../Include -I../../SuiteSparse_config
 
 I += $(GPU_CONFIG)
--- SuiteSparse/CHOLMOD/Makefile.orig	2014-07-14 21:58:01.000000000 +0200
+++ SuiteSparse/CHOLMOD/Makefile	2023-01-07 18:04:58.775960045 +0100
@@ -61,15 +61,13 @@ docs:
 
 # install CHOLMOD
 install:
-	$(CP) Lib/libcholmod.a $(INSTALL_LIB)/libcholmod.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libcholmod.$(VERSION).a libcholmod.a )
-	$(CP) Include/cholmod*.h $(INSTALL_INCLUDE)
-	$(RM) $(INSTALL_INCLUDE)/cholmod_internal.h
-	chmod 644 $(INSTALL_LIB)/libcholmod*.a
-	chmod 644 $(INSTALL_INCLUDE)/cholmod*.h
+	$(MAKE) -C Lib install
+	$(CP) Include/cholmod*.h $(DESTDIR)$(INSTALL_INCLUDE)
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/cholmod_internal.h
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/cholmod*.h
 
 # uninstall CHOLMOD
 uninstall:
-	$(RM) $(INSTALL_LIB)/libcholmod*.a
-	$(RM) $(INSTALL_INCLUDE)/cholmod*.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libcholmod.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/cholmod*.h
 
--- SuiteSparse/CSparse/Demo/Makefile.orig	2014-03-21 20:14:17.000000000 +0100
+++ SuiteSparse/CSparse/Demo/Makefile	2023-01-07 18:36:42.558979701 +0100
@@ -1,7 +1,7 @@
-CF = $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -O
+CF = $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH)
 I = -I../Include
 
-CS = ../Lib/libcsparse.a
+CS = ../Lib/libcsparse.la
 
 all: lib cs_demo1 cs_demo2 cs_demo3
 	- ./cs_demo1 < ../Matrix/t1
@@ -20,13 +20,13 @@ lib:
 	( cd ../Lib ; $(MAKE) )
 
 cs_demo1: lib cs_demo1.c Makefile
-	$(CC) $(CF) $(I) -o cs_demo1 cs_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(CF) $(LDFLAGS) $(I) -o cs_demo1 cs_demo1.c $(CS) -lm
 
 cs_demo2: lib cs_demo2.c cs_demo.c cs_demo.h Makefile
-	$(CC) $(CF) $(I) -o cs_demo2 cs_demo2.c cs_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(CF) $(LDFLAGS) $(I) -o cs_demo2 cs_demo2.c cs_demo.c $(CS) -lm
 
 cs_demo3: lib cs_demo3.c cs_demo.c cs_demo.h Makefile
-	$(CC) $(CF) $(I) -o cs_demo3 cs_demo3.c cs_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(CF) $(LDFLAGS) $(I) -o cs_demo3 cs_demo3.c cs_demo.c $(CS) -lm
 
 clean:
 	- $(RM) *.o
--- SuiteSparse/CSparse/Lib/Makefile.orig	2014-03-21 20:14:17.000000000 +0100
+++ SuiteSparse/CSparse/Lib/Makefile	2023-01-08 16:08:39.685700060 +0100
@@ -1,9 +1,9 @@
-CF = $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -O
+CF = $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH)
 I = -I../Include
-RANLIB = ranlib
-ARCHIVE = $(AR) $(ARFLAGS)
 
-all: libcsparse.a
+all: libcsparse.la
+
+include ../../SuiteSparse_config/SuiteSparse_config.mk
 
 CS = cs_add.o cs_amd.o cs_chol.o cs_cholsol.o cs_counts.o cs_cumsum.o \
 	cs_droptol.o cs_dropzeros.o cs_dupl.o cs_entry.o \
@@ -18,16 +18,19 @@ CS = cs_add.o cs_amd.o cs_chol.o cs_chol
 $(CS): ../Include/cs.h Makefile
 
 %.o: ../Source/%.c ../Include/cs.h
-	$(CC) $(CF) $(I) -c $<
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c $<
 
-libcsparse.a: $(CS)
-	$(ARCHIVE)  libcsparse.a $(CS)
-	- $(RANLIB) libcsparse.a
+libcsparse.la: $(CS)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) -o libcsparse.la -rpath $(INSTALL_LIB) $(^:.o=.lo) -lm
 
+install: libcxsparse.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libcsparse.la $(DESTDIR)$(INSTALL_LIB)/libcsparse.la
+ 
 clean:
 	- $(RM) *.o
 
 purge: distclean
 
 distclean: clean
-	- $(RM) *.a *.obj *.dll
+	- $(RM) *.la *.obj *.dll
--- SuiteSparse/CXSparse/Demo/Makefile.orig	2014-03-21 20:21:44.000000000 +0100
+++ SuiteSparse/CXSparse/Demo/Makefile	2023-01-07 18:45:48.542688520 +0100
@@ -7,7 +7,7 @@ include ../../SuiteSparse_config/SuiteSp
 
 I = -I../Include -I../../SuiteSparse_config
 
-CS = ../Lib/libcxsparse.a
+CS = ../Lib/libcxsparse.la
 
 all: $(CS) cs_demo1 cs_demo2 cs_demo3 \
 	cs_di_demo1 cs_di_demo2 cs_di_demo3 \
@@ -95,67 +95,67 @@ $(CS):
 	( cd ../Lib ; $(MAKE) )
 
 cs_demo1: $(CS) cs_demo1.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_demo1 cs_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_demo1 cs_demo1.c $(CS) -lm
 
 cs_demo2: $(CS) cs_demo2.c cs_demo.c cs_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_demo2 cs_demo2.c cs_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_demo2 cs_demo2.c cs_demo.c $(CS) -lm
 
 cs_demo3: $(CS) cs_demo3.c cs_demo.c cs_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_demo3 cs_demo3.c cs_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_demo3 cs_demo3.c cs_demo.c $(CS) -lm
 
 
 
 
 cs_di_demo1: $(CS) cs_di_demo1.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_di_demo1 cs_di_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_di_demo1 cs_di_demo1.c $(CS) -lm
 
 cs_di_demo2: $(CS) cs_di_demo2.c cs_di_demo.c cs_di_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_di_demo2 cs_di_demo2.c cs_di_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_di_demo2 cs_di_demo2.c cs_di_demo.c $(CS) -lm
 
 cs_di_demo3: $(CS) cs_di_demo3.c cs_di_demo.c cs_di_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_di_demo3 cs_di_demo3.c cs_di_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_di_demo3 cs_di_demo3.c cs_di_demo.c $(CS) -lm
 
 
 
 
 cs_ci_demo1: $(CS) cs_ci_demo1.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_ci_demo1 cs_ci_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_ci_demo1 cs_ci_demo1.c $(CS) -lm
 
 cs_ci_demo2: $(CS) cs_ci_demo2.c cs_ci_demo.c cs_ci_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_ci_demo2 cs_ci_demo2.c cs_ci_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_ci_demo2 cs_ci_demo2.c cs_ci_demo.c $(CS) -lm
 
 cs_ci_demo3: $(CS) cs_ci_demo3.c cs_ci_demo.c cs_ci_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_ci_demo3 cs_ci_demo3.c cs_ci_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_ci_demo3 cs_ci_demo3.c cs_ci_demo.c $(CS) -lm
 
 
 
 cs_dl_demo1: $(CS) cs_dl_demo1.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_dl_demo1 cs_dl_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_dl_demo1 cs_dl_demo1.c $(CS) -lm
 
 cs_dl_demo2: $(CS) cs_dl_demo2.c cs_dl_demo.c cs_dl_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_dl_demo2 cs_dl_demo2.c cs_dl_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_dl_demo2 cs_dl_demo2.c cs_dl_demo.c $(CS) -lm
 
 cs_dl_demo3: $(CS) cs_dl_demo3.c cs_dl_demo.c cs_dl_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_dl_demo3 cs_dl_demo3.c cs_dl_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_dl_demo3 cs_dl_demo3.c cs_dl_demo.c $(CS) -lm
 
 
 cs_cl_demo1: $(CS) cs_cl_demo1.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_cl_demo1 cs_cl_demo1.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_cl_demo1 cs_cl_demo1.c $(CS) -lm
 
 cs_cl_demo2: $(CS) cs_cl_demo2.c cs_cl_demo.c cs_cl_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_cl_demo2 cs_cl_demo2.c cs_cl_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_cl_demo2 cs_cl_demo2.c cs_cl_demo.c $(CS) -lm
 
 cs_cl_demo3: $(CS) cs_cl_demo3.c cs_cl_demo.c cs_cl_demo.h Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_cl_demo3 cs_cl_demo3.c cs_cl_demo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_cl_demo3 cs_cl_demo3.c cs_cl_demo.c $(CS) -lm
 
 
 
 
 cs_idemo: $(CS) cs_idemo.c Makefile $(CS)
-	$(CC) $(CF) $(I) -o cs_idemo cs_idemo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -o cs_idemo cs_idemo.c $(CS) -lm
 
 cs_ldemo: $(CS) cs_ldemo.c Makefile $(CS)
-	$(CC) $(CF) $(I) -DCS_LONG -o cs_ldemo cs_ldemo.c $(CS) -lm
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) -DCS_LONG -o cs_ldemo cs_ldemo.c $(CS) -lm
 
 
 clean:
--- SuiteSparse/CXSparse/Lib/Makefile.orig	2014-03-21 20:21:44.000000000 +0100
+++ SuiteSparse/CXSparse/Lib/Makefile	2023-01-07 18:47:51.625355057 +0100
@@ -7,7 +7,7 @@ include ../../SuiteSparse_config/SuiteSp
 
 I = -I../../SuiteSparse_config -I../Include
 
-all: libcxsparse.a
+all: libcxsparse.la
 
 CS_SOURCE = cs_add.c cs_amd.c cs_chol.c cs_cholsol.c cs_counts.c cs_cumsum.c \
 	cs_droptol.c cs_dropzeros.c cs_dupl.c cs_entry.c \
@@ -72,23 +72,26 @@ CS = cs_convert.o $(CS_DI_OBJ) $(CS_DL_O
 $(CS): ../Include/cs.h Makefile
 
 cs_convert.o: ../Source/cs_convert.c
-	$(CC) $(CF) $(I) -c $< -o $@
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c $< -o $@
 
 %_di.o : ../Source/%.c
-	$(CC) $(CF) $(I) -c $< -o $@
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -c $< -o $@
 
 %_dl.o : ../Source/%.c
-	$(CC) $(CF) $(I) -DCS_LONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -DCS_LONG -c $< -o $@
 
 %_ci.o : ../Source/%.c
-	$(CC) $(CF) $(I) -DCS_COMPLEX -c $< -o $@
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -DCS_COMPLEX -c $< -o $@
 
 %_cl.o : ../Source/%.c
-	$(CC) $(CF) $(I) -DCS_LONG -DCS_COMPLEX -c $< -o $@
+	libtool --tag=CC --mode=compile $(CC) $(CF) $(I) -DCS_LONG -DCS_COMPLEX -c $< -o $@
 
-libcxsparse.a: $(CS)
-	$(ARCHIVE)  libcxsparse.a $(CS)
-	- $(RANLIB) libcxsparse.a
+libcxsparse.la: $(CS)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libcxsparse.la -rpath $(INSTALL_LIB) $(^:.o=.lo) -lm
+
+install: libcxsparse.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libcxsparse.la $(DESTDIR)$(INSTALL_LIB)/libcxsparse.la
 
 clean:
 	- $(RM) *.o
@@ -96,4 +99,4 @@ clean:
 purge: distclean
 
 distclean: clean
-	- $(RM) *.a
+	- $(RM) *.la
--- SuiteSparse/CXSparse/Makefile.orig	2014-03-25 15:56:17.000000000 +0100
+++ SuiteSparse/CXSparse/Makefile	2023-01-07 18:48:58.658325242 +0100
@@ -38,14 +38,12 @@ distclean: purge
 
 # install CSparse
 install:
-	$(CP) Lib/libcxsparse.a $(INSTALL_LIB)/libcxsparse.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libcxsparse.$(VERSION).a libcxsparse.a )
-	$(CP) Include/cs.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libcxsparse*.a
-	chmod 644 $(INSTALL_INCLUDE)/cs.h
+	$(MAKE) -C Lib install
+	$(CP) Include/cs.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/cs.h
 
 # uninstall CSparse
 uninstall:
-	$(RM) $(INSTALL_LIB)/libcxsparse*.a
-	$(RM) $(INSTALL_INCLUDE)/cs.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libcxsparse.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/cs.h
 
--- SuiteSparse/KLU/Demo/Makefile.orig	2014-03-21 20:21:27.000000000 +0100
+++ SuiteSparse/KLU/Demo/Makefile	2023-01-07 19:13:01.833840222 +0100
@@ -5,11 +5,11 @@ default: all
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
-CLIB = ../Lib/libklu.a  ../../BTF/Lib/libbtf.a \
-	../../AMD/Lib/libamd.a ../../COLAMD/Lib/libcolamd.a \
-        ../../SuiteSparse_config/libsuitesparseconfig.a
+CLIB = ../Lib/libklu.la  ../../BTF/Lib/libbtf.la \
+	../../AMD/Lib/libamd.la ../../COLAMD/Lib/libcolamd.la \
+        ../../SuiteSparse_config/libsuitesparseconfig.la
 
-CHOLMOD_LIB = ../../CHOLMOD/Lib/libcholmod.a
+CHOLMOD_LIB = ../../CHOLMOD/Lib/libcholmod.la
 CHOLMOD = $(CHOLMOD_LIB) $(LAPACK) $(BLAS) $(XERBLA)
 
 ifneq ($(GPU_CONFIG),)
@@ -34,25 +34,25 @@ all: $(CLIB) klu_simple $(CHOLMOD_LIB) k
 	- ./kluldemo < ../Matrix/w156.mtx
 	- ./kluldemo < ../Matrix/ctina.mtx
 
-../Lib/libklu.a:
+../Lib/libklu.la:
 	( cd ../Lib ; $(MAKE) )
 
-../../BTF/Lib/libbtf.a:
+../../BTF/Lib/libbtf.la:
 	( cd ../../BTF ; $(MAKE) library )
 
-../../AMD/Lib/libamd.a:
+../../AMD/Lib/libamd.la:
 	( cd ../../AMD ; $(MAKE) library )
 
-../../COLAMD/Lib/libcolamd.a:
+../../COLAMD/Lib/libcolamd.la:
 	( cd ../../COLAMD ; $(MAKE) library )
 
-../../CHOLMOD/Lib/libcholmod.a:
+../../CHOLMOD/Lib/libcholmod.la:
 	( cd ../../CHOLMOD ; $(MAKE) library )
 #	( cd ../../CAMD ; $(MAKE) )
 #	( cd ../../CCOLAMD ; $(MAKE) )
 #	( cd ../../metis-4.0 ; $(MAKE) )
 
-../../SuiteSparse_config/libsuitesparseconfig.a:
+../../SuiteSparse_config/libsuitesparseconfig.la:
 	( cd ../../SuiteSparse_config ; $(MAKE) )
 
 purge: distclean
@@ -65,11 +65,11 @@ clean:
 	- $(RM) $(CLEAN)
 
 kludemo: kludemo.c Makefile $(CLIB)
-	$(CC) $(CF) $(I) kludemo.c -o kludemo $(CLIB) $(CHOLMOD) $(LIB)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) kludemo.c -o kludemo $(CLIB) $(CHOLMOD) $(LIB)
 
 kluldemo: kludemo.c Makefile $(CLIB)
-	$(CC) $(CF) $(I) kluldemo.c -o kluldemo $(CLIB) $(CHOLMOD) $(LIB)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) kluldemo.c -o kluldemo $(CLIB) $(CHOLMOD) $(LIB)
 
 klu_simple: klu_simple.c Makefile $(CLIB)
-	$(CC) $(CF) $(I) klu_simple.c -o klu_simple $(CLIB) $(LIB)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CF) $(I) klu_simple.c -o klu_simple $(CLIB) $(LIB)
 	- ./klu_simple
--- SuiteSparse/KLU/Lib/Makefile.orig	2014-03-21 20:21:27.000000000 +0100
+++ SuiteSparse/KLU/Lib/Makefile	2023-01-07 20:03:42.457367751 +0100
@@ -17,7 +17,7 @@ I = -I../../AMD/Include -I../../COLAMD/I
 
 all: library
 
-library: libklu.a
+library: libklu.la
 
 KLU_D = klu_d.o klu_d_kernel.o klu_d_dump.o \
     klu_d_factor.o klu_d_free_numeric.o klu_d_solve.o \
@@ -47,109 +47,112 @@ COMMON = \
 
 OBJ = $(COMMON) $(KLU_D) $(KLU_Z) $(KLU_L) $(KLU_ZL)
 
-libklu.a: $(OBJ)
-	$(ARCHIVE)  libklu.a $(OBJ)
-	- $(RANLIB) libklu.a
+libklu.la: $(OBJ)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libklu.la -rpath $(INSTALL_LIB) $(OBJ:.o=.lo) ../../COLAMD/Lib/libcolamd.la ../../AMD/Lib/libamd.la ../../BTF/Lib/libbtf.la -lm
 
+install: libklu.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libklu.la $(DESTDIR)$(INSTALL_LIB)/libklu.la
+ 
 $(OBJ): $(INC)
 
 #-------------------------------------------------------------------------------
 
 klu_d.o: ../Source/klu.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z.o: ../Source/klu.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_kernel.o: ../Source/klu_kernel.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_kernel.o: ../Source/klu_kernel.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_sort.o: ../Source/klu_sort.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_sort.o: ../Source/klu_sort.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_diagnostics.o: ../Source/klu_diagnostics.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_diagnostics.o: ../Source/klu_diagnostics.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_dump.o: ../Source/klu_dump.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_dump.o: ../Source/klu_dump.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_factor.o: ../Source/klu_factor.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_factor.o: ../Source/klu_factor.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_free_numeric.o: ../Source/klu_free_numeric.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_free_numeric.o: ../Source/klu_free_numeric.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_extract.o: ../Source/klu_extract.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_extract.o: ../Source/klu_extract.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_refactor.o: ../Source/klu_refactor.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_refactor.o: ../Source/klu_refactor.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_scale.o: ../Source/klu_scale.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_scale.o: ../Source/klu_scale.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_solve.o: ../Source/klu_solve.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_solve.o: ../Source/klu_solve.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 klu_d_tsolve.o: ../Source/klu_tsolve.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_z_tsolve.o: ../Source/klu_tsolve.c
-	$(C) -c -DCOMPLEX $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 
 klu_analyze.o: ../Source/klu_analyze.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_analyze_given.o: ../Source/klu_analyze_given.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_defaults.o: ../Source/klu_defaults.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_free_symbolic.o: ../Source/klu_free_symbolic.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 klu_memory.o: ../Source/klu_memory.c
-	$(C) -c $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 
 purge: distclean
 
 distclean: clean
-	- $(RM) libklu.a 
+	- $(RM) libklu.la 
 
 clean:
 	- $(RM) $(CLEAN)
@@ -157,92 +160,92 @@ clean:
 #-------------------------------------------------------------------------------
 
 klu_l.o: ../Source/klu.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl.o: ../Source/klu.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_kernel.o: ../Source/klu_kernel.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_kernel.o: ../Source/klu_kernel.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_sort.o: ../Source/klu_sort.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_sort.o: ../Source/klu_sort.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_diagnostics.o: ../Source/klu_diagnostics.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_diagnostics.o: ../Source/klu_diagnostics.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_dump.o: ../Source/klu_dump.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_dump.o: ../Source/klu_dump.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_factor.o: ../Source/klu_factor.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_factor.o: ../Source/klu_factor.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_free_numeric.o: ../Source/klu_free_numeric.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_free_numeric.o: ../Source/klu_free_numeric.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_extract.o: ../Source/klu_extract.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_extract.o: ../Source/klu_extract.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_refactor.o: ../Source/klu_refactor.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_refactor.o: ../Source/klu_refactor.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_scale.o: ../Source/klu_scale.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_scale.o: ../Source/klu_scale.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_solve.o: ../Source/klu_solve.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_solve.o: ../Source/klu_solve.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 klu_l_tsolve.o: ../Source/klu_tsolve.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_zl_tsolve.o: ../Source/klu_tsolve.c
-	$(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DCOMPLEX -DDLONG $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
 
 klu_l_analyze.o: ../Source/klu_analyze.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_l_analyze_given.o: ../Source/klu_analyze_given.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_l_defaults.o: ../Source/klu_defaults.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_l_free_symbolic.o: ../Source/klu_free_symbolic.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 klu_l_memory.o: ../Source/klu_memory.c
-	$(C) -c -DDLONG $(I) $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c -DDLONG $(I) $< -o $@
 
 #-------------------------------------------------------------------------------
--- SuiteSparse/KLU/Makefile.orig	2014-03-21 20:21:31.000000000 +0100
+++ SuiteSparse/KLU/Makefile	2023-01-07 20:04:46.400354675 +0100
@@ -41,14 +41,12 @@ docs:
 
 # install KLU
 install:
-	$(CP) Lib/libklu.a $(INSTALL_LIB)/libklu.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libklu.$(VERSION).a libklu.a )
-	$(CP) Include/klu.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libklu*.a
-	chmod 644 $(INSTALL_INCLUDE)/klu.h
+	$(MAKE) -C Lib install
+	$(CP) Include/klu.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/klu.h
 
 # uninstall KLU
 uninstall:
-	$(RM) $(INSTALL_LIB)/libklu*.a
-	$(RM) $(INSTALL_INCLUDE)/klu.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libklu.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/klu.h
 
--- SuiteSparse/LDL/Demo/Makefile.orig	2014-03-21 20:21:12.000000000 +0100
+++ SuiteSparse/LDL/Demo/Makefile	2023-01-07 20:19:03.482378130 +0100
@@ -12,7 +12,7 @@ C = $(CC) $(CF) $(I)
 
 all: ldlsimple ldllsimple ldlmain ldllmain ldlamd ldllamd
 
-LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+LIB2 = ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 library:
 	( cd ../../SuiteSparse_config ; $(MAKE) library )
@@ -24,34 +24,34 @@ library:
 #-------------------------------------------------------------------------------
 
 ldlmain:  ldlmain.c library
-	$(C) ldlmain.c ../Lib/libldl.a -o ldlmain $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) ldlmain.c ../Lib/libldl.la -o ldlmain $(LIB2)
 	- ./ldlmain > my_ldlmain.out
 	- diff ldlmain.out my_ldlmain.out
 
 ldllmain:  ldlmain.c library
-	$(C) -DLDL_LONG ldlmain.c ../Lib/libldl.a -o ldllmain $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -DLDL_LONG ldlmain.c ../Lib/libldl.la -o ldllmain $(LIB2)
 	- ./ldllmain > my_ldllmain.out
 	- diff ldlmain.out my_ldllmain.out
 
 ldlsimple:  ldlsimple.c library
-	$(C) ldlsimple.c ../Lib/libldl.a -o ldlsimple $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) ldlsimple.c ../Lib/libldl.la -o ldlsimple $(LIB2)
 	- ./ldlsimple > my_ldlsimple.out
 	- diff ldlsimple.out my_ldlsimple.out
 
 ldllsimple:  ldlsimple.c library
-	$(C) $(I) -DLDL_LONG ldlsimple.c ../Lib/libldl.a -o ldllsimple $(LIB2)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) $(I) -DLDL_LONG ldlsimple.c ../Lib/libldl.la -o ldllsimple $(LIB2)
 	- ./ldllsimple > my_ldllsimple.out
 	- diff ldlsimple.out my_ldllsimple.out
 
 ldlamd:  ldlmain.c library
-	- $(C) -I../../AMD/Include -DUSE_AMD \
-		ldlmain.c ../../AMD/Lib/libamd.a ../Lib/libldl.a -o ldlamd $(LIB2)
+	- libtool --tag=CC --mode=link $(C) $(LDFLAGS) -I../../AMD/Include -DUSE_AMD \
+		ldlmain.c ../../AMD/Lib/libamd.la ../Lib/libldl.la -o ldlamd $(LIB2)
 	- ./ldlamd > my_ldlamd.out
 	- diff ldlamd.out my_ldlamd.out
 
 ldllamd:  ldlmain.c library
-	- $(C) -DLDL_LONG $(I) -I../../AMD/Include -DUSE_AMD \
-		ldlmain.c ../../AMD/Lib/libamd.a ../Lib/libldl.a -o ldllamd $(LIB2)
+	- libtool --tag=CC --mode=link $(C) $(LDFLAGS) -DLDL_LONG $(I) -I../../AMD/Include -DUSE_AMD \
+		ldlmain.c ../../AMD/Lib/libamd.la ../Lib/libldl.la -o ldllamd $(LIB2)
 	- ./ldllamd > my_ldllamd.out
 	- diff ldllamd.out my_ldllamd.out
 
--- SuiteSparse/LDL/Lib/Makefile.orig	2014-03-21 20:21:12.000000000 +0100
+++ SuiteSparse/LDL/Lib/Makefile	2023-01-07 20:20:48.698474792 +0100
@@ -10,22 +10,25 @@ I = -I../../SuiteSparse_config -I../Incl
 
 C = $(CC) $(CF) $(I)
 
-all: libldl.a
+all: libldl.la
 
 #-------------------------------------------------------------------------------
 # the ldl library:
 #-------------------------------------------------------------------------------
 
-libldl.a: ../Source/ldl.c ../Include/ldl.h
-	$(C) -c ../Source/ldl.c -o ldl.o
-	$(C) -DLDL_LONG -c ../Source/ldl.c -o ldll.o
-	$(ARCHIVE)  libldl.a ldl.o ldll.o
-	- $(RANLIB) libldl.a
+libldl.la: ../Source/ldl.c ../Include/ldl.h
+	libtool --tag=CC --mode=compile $(C) -c ../Source/ldl.c -o ldl.o
+	libtool --tag=CC --mode=compile $(C) -DLDL_LONG -c ../Source/ldl.c -o ldll.o
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CFLAGS) -o libldl.la -rpath $(INSTALL_LIB) ldl.lo ldll.lo
+
+install: libldl.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libldl.la $(DESTDIR)$(INSTALL_LIB)/libldl.la
 
 distclean: purge
 
 purge: clean
-	- $(RM) libldl.a
+	- $(RM) libldl.la
 
 clean:
 	- $(RM) $(CLEAN)
--- SuiteSparse/LDL/Makefile.orig	2014-03-21 20:21:16.000000000 +0100
+++ SuiteSparse/LDL/Makefile	2023-01-07 20:21:27.178266329 +0100
@@ -50,14 +50,12 @@ lib: library
 
 # install LDL
 install:
-	$(CP) Lib/libldl.a $(INSTALL_LIB)/libldl.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libldl.$(VERSION).a libldl.a )
-	$(CP) Include/ldl.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libldl*.a
-	chmod 644 $(INSTALL_INCLUDE)/ldl.h
+	$(MAKE) -C Lib install
+	$(CP) Include/ldl.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/ldl.h
 
 # uninstall LDL
 uninstall:
-	$(RM) $(INSTALL_LIB)/libldl*.a
-	$(RM) $(INSTALL_INCLUDE)/ldl.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libldl.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/ldl.h
 
--- SuiteSparse/RBio/Demo/Makefile.orig	2014-03-21 20:22:02.000000000 +0100
+++ SuiteSparse/RBio/Demo/Makefile	2023-01-07 20:55:21.607244881 +0100
@@ -6,7 +6,7 @@ default: all
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
-CLIB = ../Lib/librbio.a ../../SuiteSparse_config/libsuitesparseconfig.a $(LIB)
+CLIB = ../Lib/librbio.la ../../SuiteSparse_config/libsuitesparseconfig.la $(LIB)
 
 C = $(CC) $(CF)
 
@@ -33,5 +33,5 @@ library:
 I = -I../Include -I../../SuiteSparse_config
 
 RBdemo: library RBdemo.c
-	$(C) -o RBdemo $(I) RBdemo.c $(CLIB)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o RBdemo $(I) RBdemo.c $(CLIB)
 
--- SuiteSparse/RBio/Lib/Makefile.orig	2014-03-21 20:22:02.000000000 +0100
+++ SuiteSparse/RBio/Lib/Makefile	2023-01-07 21:05:15.984024865 +0100
@@ -10,14 +10,14 @@ include ../../SuiteSparse_config/SuiteSp
 
 C = $(CC) $(CF)
 
-all: librbio.a
+all: librbio.la
 
-library: librbio.a
+library: librbio.la
 
 purge: distclean
 
 distclean: clean
-	- $(RM) librbio.a
+	- $(RM) librbio.la
 
 clean:
 	- $(RM) $(CLEAN)
@@ -32,22 +32,25 @@ INC = ../Include/RBio.h
 # The 7 CHOLMOD library modules (int, double)
 #-------------------------------------------------------------------------------
 
-CORE = RBio.o
+CORE = RBio_i.o
 
 DI = $(CORE)
 
-LCORE = RBio_long.o
+LCORE = RBio.o
 
 DL = $(LCORE)
 
 #-------------------------------------------------------------------------------
 
 # to compile just the double/int version, use OBJ = $(DI)
-OBJ = $(DI)
+OBJ = $(DI) $(DL)
 
-librbio.a: $(OBJ)
-	$(ARCHIVE)  librbio.a $(OBJ)
-	- $(RANLIB) librbio.a
+librbio.la: $(OBJ)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) $(CFLAGS) -o librbio.la -rpath $(INSTALL_LIB) $(OBJ:.o=.lo) ../../SuiteSparse_config/libsuitesparseconfig.la
+
+install: librbio.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp librbio.la $(DESTDIR)$(INSTALL_LIB)/librbio.la
 
 $(OBJ): $(INC)
 
@@ -56,8 +59,8 @@ I = -I../Include -I../../SuiteSparse_con
 #-------------------------------------------------------------------------------
 
 RBio.o: ../Source/RBio.c
-	$(C) -c $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c $(I) $<
 
 RBio_i.o: ../Source/RBio.c
-	$(C) -c -DINT $(I) $<
+	libtool --tag=CC --mode=compile $(C) -c -DINT $(I) $< -o $@
 
--- SuiteSparse/RBio/Makefile.orig	2014-03-21 20:22:06.000000000 +0100
+++ SuiteSparse/RBio/Makefile	2023-01-07 21:06:04.600428154 +0100
@@ -51,14 +51,12 @@ demos:
 
 # install RBio
 install:
-	$(CP) Lib/librbio.a $(INSTALL_LIB)/librbio.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf librbio.$(VERSION).a librbio.a )
-	$(CP) Include/RBio.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/librbio*.a
-	chmod 644 $(INSTALL_INCLUDE)/RBio.h
+	$(MAKE) -C Lib install
+	$(CP) Include/RBio.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/RBio.h
 
 # uninstall RBio
 uninstall:
-	$(RM) $(INSTALL_LIB)/librbio*.a
-	$(RM) $(INSTALL_INCLUDE)/RBio.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/librbio.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/RBio.h
 
--- SuiteSparse/SPQR/Demo/Makefile.orig	2014-07-14 21:46:58.000000000 +0200
+++ SuiteSparse/SPQR/Demo/Makefile	2023-01-07 21:33:51.208066033 +0100
@@ -20,9 +20,9 @@ ifeq (,$(findstring -DNPARTITION, $(CHOL
         ifeq (../../CAMD, $(wildcard ../../CAMD))
             ifeq (../../CCOLAMD, $(wildcard ../../CCOLAMD))
                 # METIS, CAMD, and CCOLAMD are available
-                LIB_WITH_PARTITION = $(METIS) ../../CCOLAMD/Lib/libccolamd.a \
-                    ../../CAMD/Lib/libcamd.a
-                I_WITH_PARTITION = -I$(METIS_PATH)/Lib \
+                LIB_WITH_PARTITION = $(METIS) ../../CCOLAMD/Lib/libccolamd.la \
+                    ../../CAMD/Lib/libcamd.la
+                I_WITH_PARTITION = -I$(METIS_PATH) \
                     -I../../CCOLAMD/Include -I../../CAMD/Include
                 CONFIG =
             endif
@@ -31,10 +31,10 @@ ifeq (,$(findstring -DNPARTITION, $(CHOL
 endif
 #-------------------------------------------------------------------------------
 
-CLIB = ../Lib/libspqr.a \
-        ../../SuiteSparse_config/libsuitesparseconfig.a \
-	../../CHOLMOD/Lib/libcholmod.a ../../AMD/Lib/libamd.a \
-	../../COLAMD/Lib/libcolamd.a $(LIB_WITH_PARTITION)
+CLIB = ../Lib/libspqr.la \
+        ../../SuiteSparse_config/libsuitesparseconfig.la \
+	../../CHOLMOD/Lib/libcholmod.la ../../AMD/Lib/libamd.la \
+	../../COLAMD/Lib/libcolamd.la $(LIB_WITH_PARTITION)
 
 # use the BLAS and LAPACK defined by SuiteSparse_config.mk; do not use valgrind 
 FLIB = $(LAPACK) $(BLAS)
@@ -106,30 +106,27 @@ cdemo: qrdemoc
 	- $(V) ./qrdemoc < ../Matrix/Ragusa16.mtx
 	- $(V) ./qrdemoc < ../Matrix/young1c.mtx
 
-../Lib/libspqr.a:
+../Lib/libspqr.la:
 	( cd ../Lib ; $(MAKE) )
 
-../../AMD/Lib/libamd.a:
+../../AMD/Lib/libamd.la:
 	( cd ../../AMD ; $(MAKE) library )
 
-../../SuiteSparse_config/libsuitesparseconfig.a:
+../../SuiteSparse_config/libsuitesparseconfig.la:
 	( cd ../../SuiteSparse_config ; $(MAKE) library )
 
-../../CHOLMOD/Lib/libcholmod.a:
+../../CHOLMOD/Lib/libcholmod.la:
 	- ( cd ../../CHOLMOD && $(MAKE) library )
 
-../../COLAMD/Lib/libcolamd.a:
+../../COLAMD/Lib/libcolamd.la:
 	- ( cd ../../COLAMD && $(MAKE) library )
 
-../../CCOLAMD/Lib/libccolamd.a:
+../../CCOLAMD/Lib/libccolamd.la:
 	- ( cd ../../CCOLAMD && $(MAKE) library )
 
-../../CAMD/Lib/libcamd.a:
+../../CAMD/Lib/libcamd.la:
 	- ( cd ../../CAMD && $(MAKE) library )
 
-$(METIS):
-	( cd $(METIS_PATH) && $(MAKE) )
-
 library:
 	( cd ../Lib ; $(MAKE) )
 	( cd ../../AMD ; $(MAKE) library )
@@ -164,10 +161,10 @@ LIBS += $(CUDART_LIB) $(CUBLAS_LIB)
 endif
 
 qrsimple: qrsimple.cpp library $(INC)
-	$(C) qrsimple.cpp -o qrsimple $(LIBS)
+	libtool --tag=CXX --mode=link $(C) $(LDFLAGS) qrsimple.cpp -o qrsimple $(LIBS)
 
 qrdemo: qrdemo.cpp library $(INC)
-	$(C) qrdemo.cpp -o qrdemo $(LIBS)
+	libtool --tag=CXX --mode=link $(C) $(LDFLAGS) qrdemo.cpp -o qrdemo $(LIBS)
 
 # compile the C code with gcc, but link with g++ to use SuiteSparseQR:
 
@@ -175,11 +172,11 @@ qrdemoc.o: qrdemoc.c $(INC)
 	$(CC) $(CF) $(SPQR_CONFIG) -ansi $(I) -c $<
 
 qrdemoc: qrdemoc.o library $(INC)
-	$(C) -o qrdemoc qrdemoc.o $(LIBS)
+	libtool --tag=CXX --mode=link $(C) $(LDFLAGS) -o qrdemoc qrdemoc.o $(LIBS)
 
 qrsimplec.o: qrsimplec.c $(INC)
 	$(CC) $(CF) $(SPQR_CONFIG) -ansi $(I) -c $<
 
 qrsimplec: qrsimplec.o library $(INC)
-	$(C) -o qrsimplec qrsimplec.o $(LIBS)
+	libtool --tag=CXX --mode=link $(C) $(LDFLAGS) -o qrsimplec qrsimplec.o $(LIBS)
 
--- SuiteSparse/SPQR/Lib/Makefile.orig	2012-06-21 07:37:08.000000000 +0200
+++ SuiteSparse/SPQR/Lib/Makefile	2023-01-07 21:37:34.776854856 +0100
@@ -20,9 +20,9 @@ ifeq (,$(findstring -DNPARTITION, $(CHOL
         ifeq (../../CAMD, $(wildcard ../../CAMD))
             ifeq (../../CCOLAMD, $(wildcard ../../CCOLAMD))
                 # METIS, CAMD, and CCOLAMD are available
-                LIB_WITH_PARTITION = $(METIS) ../../CCOLAMD/Lib/libccolamd.a \
-                    ../../CAMD/Lib/libcamd.a
-                I_WITH_PARTITION = -I$(METIS_PATH)/Lib \
+                LIB_WITH_PARTITION = $(METIS) ../../CCOLAMD/Lib/libccolamd.la \
+                    ../../CAMD/Lib/libcamd.la
+                I_WITH_PARTITION = -I$(METIS_PATH) \
                     -I../../CCOLAMD/Include -I../../CAMD/Include
                 CONFIG =
             endif
@@ -37,14 +37,14 @@ endif
 # 	-Wredundant-decls -Wdisabled-optimization \
 # 	-ansi -fexceptions
 
-all: libspqr.a
+all: libspqr.la
 
-library: libspqr.a
+library: libspqr.la
 
 purge: distclean
 
 distclean: clean
-	- $(RM) libspqr.a
+	- $(RM) libspqr.la
 
 clean:
 	- $(RM) $(CLEAN)
@@ -101,126 +101,130 @@ I = -I../../CHOLMOD/Include -I../../Suit
 
 C = $(CXX) $(CF) $(SPQR_CONFIG) $(CONFIG) $(I)
 
-libspqr.a: $(OBJ)
-	$(ARCHIVE)  libspqr.a $(OBJ)
-	- $(RANLIB) libspqr.a
+libspqr.la: $(OBJ)
+	libtool --tag=CXX --mode=link $(CXX) $(LDFLAGS) -o libspqr.la -rpath $(INSTALL_LIB) $(OBJ:.o=.lo) \
+		../../CHOLMOD/Lib/libcholmod.la $(LIB_WITH_PARTITION) -lm
+
+install: libspqr.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install cp libspqr.la $(DESTDIR)$(INSTALL_LIB)/libspqr.la
 
 spqr_1colamd.o: ../Source/spqr_1colamd.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_1factor.o: ../Source/spqr_1factor.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_1fixed.o: ../Source/spqr_1fixed.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_analyze.o: ../Source/spqr_analyze.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_parallel.o: ../Source/spqr_parallel.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_kernel.o: ../Source/spqr_kernel.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_append.o: ../Source/spqr_append.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_assemble.o: ../Source/spqr_assemble.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_cpack.o: ../Source/spqr_cpack.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_csize.o: ../Source/spqr_csize.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_cumsum.o: ../Source/spqr_cumsum.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_debug.o: ../Source/spqr_debug.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_factorize.o: ../Source/spqr_factorize.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_fcsize.o: ../Source/spqr_fcsize.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_freefac.o: ../Source/spqr_freefac.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_freenum.o: ../Source/spqr_freenum.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_freesym.o: ../Source/spqr_freesym.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_fsize.o: ../Source/spqr_fsize.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_happly.o: ../Source/spqr_happly.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_panel.o: ../Source/spqr_panel.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_happly_work.o: ../Source/spqr_happly_work.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_hpinv.o: ../Source/spqr_hpinv.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_larftb.o: ../Source/spqr_larftb.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_rconvert.o: ../Source/spqr_rconvert.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_rcount.o: ../Source/spqr_rcount.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_rhpack.o: ../Source/spqr_rhpack.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_rsolve.o: ../Source/spqr_rsolve.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_shift.o: ../Source/spqr_shift.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_stranspose1.o: ../Source/spqr_stranspose1.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_stranspose2.o: ../Source/spqr_stranspose2.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_trapezoidal.o: ../Source/spqr_trapezoidal.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_type.o: ../Source/spqr_type.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_front.o: ../Source/spqr_front.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 SuiteSparseQR_expert.o: ../Source/SuiteSparseQR_expert.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_maxcolnorm.o: ../Source/spqr_maxcolnorm.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 SuiteSparseQR_qmult.o: ../Source/SuiteSparseQR_qmult.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 SuiteSparseQR.o: ../Source/SuiteSparseQR.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_tol.o: ../Source/spqr_tol.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 SuiteSparseQR_C.o: ../Source/SuiteSparseQR_C.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
 
 spqr_rmap.o: ../Source/spqr_rmap.cpp
-	$(C) -c $<
+	libtool --tag=CXX --mode=compile $(C) -c $<
--- SuiteSparse/SPQR/Makefile.orig	2014-07-14 22:05:03.000000000 +0200
+++ SuiteSparse/SPQR/Makefile	2023-01-07 21:38:48.839786956 +0100
@@ -43,23 +43,21 @@ docs:
 
 # install SPQR
 install:
-	$(CP) Lib/libspqr.a $(INSTALL_LIB)/libspqr.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libspqr.$(VERSION).a libspqr.a )
-	$(CP) Include/SuiteSparseQR.hpp $(INSTALL_INCLUDE)
-	$(CP) Include/SuiteSparseQR_C.h $(INSTALL_INCLUDE)
-	$(CP) Include/SuiteSparseQR_definitions.h $(INSTALL_INCLUDE)
-	$(CP) Include/spqr.hpp $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libspqr*.a
-	chmod 644 $(INSTALL_INCLUDE)/SuiteSparseQR.hpp
-	chmod 644 $(INSTALL_INCLUDE)/SuiteSparseQR_C.h
-	chmod 644 $(INSTALL_INCLUDE)/SuiteSparseQR_definitions.h
-	chmod 644 $(INSTALL_INCLUDE)/spqr.hpp
+	$(MAKE) -C Lib install
+	$(CP) Include/SuiteSparseQR.hpp $(DESTDIR)$(INSTALL_INCLUDE)
+	$(CP) Include/SuiteSparseQR_C.h $(DESTDIR)$(INSTALL_INCLUDE)
+	$(CP) Include/SuiteSparseQR_definitions.h $(DESTDIR)$(INSTALL_INCLUDE)
+	$(CP) Include/spqr.hpp $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR.hpp
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR_C.h
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR_definitions.h
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/spqr.hpp
 
 # uninstall SPQR
 uninstall:
-	$(RM) $(INSTALL_LIB)/libspqr*.a
-	$(RM) $(INSTALL_INCLUDE)/SuiteSparseQR.hpp
-	$(RM) $(INSTALL_INCLUDE)/SuiteSparseQR_C.h
-	$(RM) $(INSTALL_INCLUDE)/SuiteSparseQR_definitions.h
-	$(RM) $(INSTALL_INCLUDE)/spqr.hpp
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libspqr.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR.hpp
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR_C.h
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/SuiteSparseQR_definitions.h
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/spqr.hpp
 
--- SuiteSparse/UMFPACK/Demo/Makefile.orig	2014-03-22 03:19:44.000000000 +0100
+++ SuiteSparse/UMFPACK/Demo/Makefile	2023-01-07 22:04:59.537944421 +0100
@@ -27,8 +27,8 @@ ifeq (,$(findstring -DNCHOLMOD, $(UMFPAC
         ifeq (../../COLAMD, $(wildcard ../../COLAMD))
             # CHOLMOD and COLAMD are available
             CONFIG1 =
-            LIB_WITH_CHOLMOD = ../../CHOLMOD/Lib/libcholmod.a \
-                ../../COLAMD/Lib/libcolamd.a
+            LIB_WITH_CHOLMOD = ../../CHOLMOD/Lib/libcholmod.la \
+                ../../COLAMD/Lib/libcolamd.la
             # check if METIS is requested and available
             ifeq (,$(findstring -DNPARTITION, $(CHOLMOD_CONFIG)))
                 # METIS is requested.  See if it is available
@@ -37,9 +37,9 @@ ifeq (,$(findstring -DNCHOLMOD, $(UMFPAC
                         ifeq (../../CCOLAMD, $(wildcard ../../CCOLAMD))
                             # METIS, CAMD, and CCOLAMD are available
                             LIB_WITH_PARTITION = $(METIS) \
-                                ../../CCOLAMD/Lib/libccolamd.a \
-                                ../../CAMD/Lib/libcamd.a
-                            I_WITH_PARTITION = -I$(METIS_PATH)/Lib \
+                                ../../CCOLAMD/Lib/libccolamd.la \
+                                ../../CAMD/Lib/libcamd.la
+                            I_WITH_PARTITION = -I$(METIS_PATH) \
                                 -I../../CCOLAMD/Include -I../../CAMD/Include
                             CONFIG2 =
                         endif
@@ -58,33 +58,30 @@ INC = ../Include/umfpack.h ../../AMD/Inc
 
 LIBS = $(LAPACK) $(BLAS) $(XERBLA) $(LIB) $(LIB_WITH_CHOLMOD) $(LIB_WITH_PARTITION) $(CUBLAS_LIB) $(CUDART_LIB)
 
-../Lib/libumfpack.a:
+../Lib/libumfpack.la:
 	( cd ../Lib ; $(MAKE) )
 
-../../AMD/Lib/libamd.a:
+../../AMD/Lib/libamd.la:
 	( cd ../../AMD ; $(MAKE) library )
 
-../../SuiteSparse_config/libsuitesparseconfig.a:
+../../SuiteSparse_config/libsuitesparseconfig.la:
 	( cd ../../SuiteSparse_config ; $(MAKE) library )
 
-../../CHOLMOD/Lib/libcholmod.a:
+../../CHOLMOD/Lib/libcholmod.la:
 	- ( cd ../../CHOLMOD && $(MAKE) library )
 
-../../COLAMD/Lib/libcolamd.a:
+../../COLAMD/Lib/libcolamd.la:
 	- ( cd ../../COLAMD && $(MAKE) library )
 
 
-../../CCOLAMD/Lib/libccolamd.a:
+../../CCOLAMD/Lib/libccolamd.la:
 	- ( cd ../../CCOLAMD && $(MAKE) library )
 
-../../CAMD/Lib/libcamd.a:
+../../CAMD/Lib/libcamd.la:
 	- ( cd ../../CAMD && $(MAKE) library )
 
-$(METIS):
-	( cd $(METIS_PATH) && $(MAKE) )
-
-UMFPACK = ../Lib/libumfpack.a ../../AMD/Lib/libamd.a \
-    ../../SuiteSparse_config/libsuitesparseconfig.a \
+UMFPACK = ../Lib/libumfpack.la ../../AMD/Lib/libamd.la \
+    ../../SuiteSparse_config/libsuitesparseconfig.la \
     $(LIB_WITH_CHOLMOD) $(LIB_WITH_PARTITION) 
 
 libs: $(UMFPACK)
@@ -96,7 +93,7 @@ libs: $(UMFPACK)
 dist: umfpack_di_demo.c umfpack_dl_demo.c umfpack_zi_demo.c umfpack_zl_demo.c
 
 umfpack_simple: umfpack_simple.c $(INC) $(UMFPACK)
-	$(C) -o umfpack_simple umfpack_simple.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umfpack_simple umfpack_simple.c $(UMFPACK) $(LIBS)
 
 # the GNU rules are simpler:
 # umfpack_%_demo.c: umfpack_xx_demo.c umfpack_%_demo.sed
@@ -113,28 +110,28 @@ umfpack_di_demo.c: umfpack_xx_demo.c umf
 	- sed -f umfpack_di_demo.sed < umfpack_xx_demo.c > umfpack_di_demo.c
 
 umfpack_di_demo: umfpack_di_demo.c $(INC) $(UMFPACK)
-	$(C) -o umfpack_di_demo umfpack_di_demo.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umfpack_di_demo umfpack_di_demo.c $(UMFPACK) $(LIBS)
 
 # double-precision, SuiteSparse_long verion:
 umfpack_dl_demo.c: umfpack_xx_demo.c umfpack_dl_demo.sed
 	- sed -f umfpack_dl_demo.sed < umfpack_xx_demo.c > umfpack_dl_demo.c
 
 umfpack_dl_demo: umfpack_dl_demo.c $(INC) $(UMFPACK)
-	$(C) -o umfpack_dl_demo umfpack_dl_demo.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umfpack_dl_demo umfpack_dl_demo.c $(UMFPACK) $(LIBS)
 
 # complex, int verion:
 umfpack_zi_demo.c: umfpack_xx_demo.c umfpack_zi_demo.sed
 	- sed -f umfpack_zi_demo.sed < umfpack_xx_demo.c > umfpack_zi_demo.c
 
 umfpack_zi_demo: umfpack_zi_demo.c $(INC) $(UMFPACK)
-	$(C) -o umfpack_zi_demo umfpack_zi_demo.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umfpack_zi_demo umfpack_zi_demo.c $(UMFPACK) $(LIBS)
 
 # complex, SuiteSparse_long verion:
 umfpack_zl_demo.c: umfpack_xx_demo.c umfpack_zl_demo.sed
 	- sed -f umfpack_zl_demo.sed < umfpack_xx_demo.c > umfpack_zl_demo.c
 
 umfpack_zl_demo: umfpack_zl_demo.c $(INC) $(UMFPACK)
-	$(C) -o umfpack_zl_demo umfpack_zl_demo.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umfpack_zl_demo umfpack_zl_demo.c $(UMFPACK) $(LIBS)
 
 run: umfpack_di_demo umfpack_zi_demo umfpack_dl_demo umfpack_zl_demo umfpack_simple
 	./umfpack_simple
@@ -176,16 +173,16 @@ hb: $(UMFPACK) umf4 readhb readhb_nozero
 	- ./umf4 a 1e-6
 
 umf4: umf4.c $(UMFPACK)
-	$(C) -o umf4 umf4.c $(UMFPACK) $(LIBS)
+	libtool --tag=CC --mode=link $(C) $(LDFLAGS) -o umf4 umf4.c $(UMFPACK) $(LIBS)
 
 readhb:  readhb.f
-	$(F77) $(F77FLAGS) -o readhb readhb.f $(F77LIB)
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o readhb readhb.f $(F77LIB)
 
 readhb_size:  readhb_size.f
-	$(F77) $(F77FLAGS) -o readhb_size readhb_size.f $(F77LIB)
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o readhb_size readhb_size.f $(F77LIB)
 
 readhb_nozeros:  readhb_nozeros.f
-	$(F77) $(F77FLAGS) -o readhb_nozeros readhb_nozeros.f $(F77LIB)
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o readhb_nozeros readhb_nozeros.f $(F77LIB)
 
 #-------------------------------------------------------------------------------
 # compile the FORTRAN interface and demo
@@ -193,17 +190,17 @@ readhb_nozeros:  readhb_nozeros.f
 
 # This doesn't seem to work on the Mac (Snow Leopard, OS X 10.6.1)
 fortran: $(UMFPACK) umf4hb.f umf4_f77wrapper.o umf4zhb.f umf4_f77zwrapper.o $(UMFPACK)
-	$(F77) $(F77FLAGS) -o umf4hb umf4hb.f umf4_f77wrapper.o \
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o umf4hb umf4hb.f umf4_f77wrapper.o \
 	    $(UMFPACK) $(LIBS)
 	- ./umf4hb < HB/west0067.rua > my_umf4hb.out
 	- diff my_umf4hb.out umf4hb.out
-	$(F77) $(F77FLAGS) -o umf4zhb umf4zhb.f umf4_f77zwrapper.o \
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o umf4zhb umf4zhb.f umf4_f77zwrapper.o \
 	    $(UMFPACK) $(LIBS)
 	- ./umf4zhb < HB/qc324.cua > my_umf4zhb.out
 	- diff my_umf4zhb.out umf4zhb.out
 
 fortran64: $(UMFPACK) umf4hb64.f umf4_f77wrapper64.o umf4_f77zwrapper64.o $(UMFPACK)
-	$(F77) $(F77FLAGS) -o umf4hb64 umf4hb64.f umf4_f77wrapper64.o \
+	libtool --tag=F77 --mode=link $(F77) $(LDFLAGS) $(F77FLAGS) -o umf4hb64 umf4hb64.f umf4_f77wrapper64.o \
 	    $(UMFPACK) $(LIBS)
 	- ./umf4hb64 < HB/west0067.rua > my_umf4hb64.out
 	- diff my_umf4hb64.out umf4hb64.out
--- SuiteSparse/UMFPACK/Lib/GNUmakefile.orig	2014-03-21 20:16:16.000000000 +0100
+++ SuiteSparse/UMFPACK/Lib/GNUmakefile	2023-01-08 15:36:19.499544284 +0100
@@ -2,16 +2,18 @@
 # UMFPACK Makefile for compiling on Unix systems (for GNU Make)
 #-------------------------------------------------------------------------------
 
-default: libumfpack.a
+default: libumfpack.la
 
 include ../../SuiteSparse_config/SuiteSparse_config.mk
 
 # UMFPACK can use CHOLMOD by default as an ordering option
 ifneq (,$(findstring -DNCHOLMOD, $(UMFPACK_CONFIG)))
     I = -I../Include -I../Source -I../../AMD/Include -I../../SuiteSparse_config
+    LIBS = ../../AMD/Lib/libamd.la -lblas
 else
     I = -I../Include -I../Source -I../../AMD/Include \
         -I../../SuiteSparse_config -I../../CHOLMOD/Include
+    LIBS = ../../CHOLMOD/Lib/libcholmod.la ../../AMD/Lib/libamd.la -lblas
 endif
 
 C = $(CC) $(CF) $(UMFPACK_CONFIG) $(I)
@@ -101,171 +103,171 @@ GN = $(addsuffix .o, $(subst umfpack_,um
 #-------------------------------------------------------------------------------
 
 umf_i_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 umf_l_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # compile each routine in the DI version
 #-------------------------------------------------------------------------------
 
 umf_di_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 umf_di_%hsolve.o: ../Source/umf_%tsolve.c $(INC)
-	$(C) -DDINT -DCONJUGATE_SOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DCONJUGATE_SOLVE -c $< -o $@
 
 umf_di_triplet_map_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDINT -DDO_MAP -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DDO_MAP -DDO_VALUES -c $< -o $@
 
 umf_di_triplet_map_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDINT -DDO_MAP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DDO_MAP -c $< -o $@
 
 umf_di_triplet_nomap_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDINT -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DDO_VALUES -c $< -o $@
 
 umf_di_triplet_nomap_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 umf_di_assemble_fixq.o: ../Source/umf_assemble.c $(INC)
-	$(C) -DDINT -DFIXQ -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DFIXQ -c $< -o $@
 
 umf_di_store_lu_drop.o: ../Source/umf_store_lu.c $(INC)
-	$(C) -DDINT -DDROP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DDROP -c $< -o $@
 
 umfpack_di_wsolve.o: ../Source/umfpack_solve.c $(INC)
-	$(C) -DDINT -DWSOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -DWSOLVE -c $< -o $@
 
 umfpack_di_%.o: ../Source/umfpack_%.c $(INC)
-	$(C) -DDINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDINT -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # compile each routine in the DL version
 #-------------------------------------------------------------------------------
 
 umf_dl_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 umf_dl_%hsolve.o: ../Source/umf_%tsolve.c $(INC)
-	$(C) -DDLONG -DCONJUGATE_SOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DCONJUGATE_SOLVE -c $< -o $@
 
 umf_dl_triplet_map_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDLONG -DDO_MAP -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DDO_MAP -DDO_VALUES -c $< -o $@
 
 umf_dl_triplet_map_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDLONG -DDO_MAP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DDO_MAP -c $< -o $@
 
 umf_dl_triplet_nomap_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDLONG -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DDO_VALUES -c $< -o $@
 
 umf_dl_triplet_nomap_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 umf_dl_assemble_fixq.o: ../Source/umf_assemble.c $(INC)
-	$(C) -DDLONG -DFIXQ -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DFIXQ -c $< -o $@
 
 umf_dl_store_lu_drop.o: ../Source/umf_store_lu.c $(INC)
-	$(C) -DDLONG -DDROP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DDROP -c $< -o $@
 
 umfpack_dl_wsolve.o: ../Source/umfpack_solve.c $(INC)
-	$(C) -DDLONG -DWSOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -DWSOLVE -c $< -o $@
 
 umfpack_dl_%.o: ../Source/umfpack_%.c $(INC)
-	$(C) -DDLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DDLONG -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # compile each routine in the ZI version
 #-------------------------------------------------------------------------------
 
 umf_zi_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DZINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -c $< -o $@
 
 umf_zi_%hsolve.o: ../Source/umf_%tsolve.c $(INC)
-	$(C) -DZINT -DCONJUGATE_SOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DCONJUGATE_SOLVE -c $< -o $@
 
 umf_zi_triplet_map_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZINT -DDO_MAP -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DDO_MAP -DDO_VALUES -c $< -o $@
 
 umf_zi_triplet_map_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZINT -DDO_MAP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DDO_MAP -c $< -o $@
 
 umf_zi_triplet_nomap_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZINT -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DDO_VALUES -c $< -o $@
 
 umf_zi_triplet_nomap_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -c $< -o $@
 
 umf_zi_assemble_fixq.o: ../Source/umf_assemble.c $(INC)
-	$(C) -DZINT -DFIXQ -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DFIXQ -c $< -o $@
 
 umf_zi_store_lu_drop.o: ../Source/umf_store_lu.c $(INC)
-	$(C) -DZINT -DDROP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DDROP -c $< -o $@
 
 umfpack_zi_wsolve.o: ../Source/umfpack_solve.c $(INC)
-	$(C) -DZINT -DWSOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -DWSOLVE -c $< -o $@
 
 umfpack_zi_%.o: ../Source/umfpack_%.c $(INC)
-	$(C) -DZINT -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZINT -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # compile each routine in the ZL version
 #-------------------------------------------------------------------------------
 
 umf_zl_%.o: ../Source/umf_%.c $(INC)
-	$(C) -DZLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -c $< -o $@
 
 umf_zl_%hsolve.o: ../Source/umf_%tsolve.c $(INC)
-	$(C) -DZLONG -DCONJUGATE_SOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DCONJUGATE_SOLVE -c $< -o $@
 
 umf_zl_triplet_map_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZLONG -DDO_MAP -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DDO_MAP -DDO_VALUES -c $< -o $@
 
 umf_zl_triplet_map_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZLONG -DDO_MAP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DDO_MAP -c $< -o $@
 
 umf_zl_triplet_nomap_x.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZLONG -DDO_VALUES -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DDO_VALUES -c $< -o $@
 
 umf_zl_triplet_nomap_nox.o: ../Source/umf_triplet.c $(INC)
-	$(C) -DZLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -c $< -o $@
 
 umf_zl_assemble_fixq.o: ../Source/umf_assemble.c $(INC)
-	$(C) -DZLONG -DFIXQ -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DFIXQ -c $< -o $@
 
 umf_zl_store_lu_drop.o: ../Source/umf_store_lu.c $(INC)
-	$(C) -DZLONG -DDROP -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DDROP -c $< -o $@
 
 umfpack_zl_wsolve.o: ../Source/umfpack_solve.c $(INC)
-	$(C) -DZLONG -DWSOLVE -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -DWSOLVE -c $< -o $@
 
 umfpack_zl_%.o: ../Source/umfpack_%.c $(INC)
-	$(C) -DZLONG -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -DZLONG -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # Create the generic routines (GN) using a generic rule
 #-------------------------------------------------------------------------------
 
 umfpack_gn_%.o: ../Source/umfpack_%.c $(INC)
-	$(C) -c $< -o $@
+	libtool --tag=CC --mode=compile $(C) -c $< -o $@
 
 #-------------------------------------------------------------------------------
 # Create the libumfpack.a library
 #-------------------------------------------------------------------------------
 
-libumfpack.a: $(II) $(LL) $(GN) $(DI) $(DL) $(ZI) $(ZL)
-	$(ARCHIVE)  libumfpack.a $^
-	- $(RANLIB) libumfpack.a
+libumfpack.la: $(II) $(LL) $(GN) $(DI) $(DL) $(ZI) $(ZL)
+	libtool --tag=CC --mode=link $(CC) $(LDFLAGS) -o libumfpack.la -rpath $(INSTALL_LIB) $(^:.o=.lo) $(LIBS) -lm
 
-so: $(II) $(LL) $(GN) $(DI) $(DL) $(ZI) $(ZL)
-	gcc -shared -Wl,-soname,libumfpack.so -o libumfpack.so $^
+install: libumfpack.la
+	install -d $(DESTDIR)$(INSTALL_LIB)
+	libtool --mode=install install libumfpack.la $(DESTDIR)$(INSTALL_LIB)
 
 #-------------------------------------------------------------------------------
 # Remove all but the files in the original distribution
 #-------------------------------------------------------------------------------
 
 purge: clean
-	- $(RM) libumfpack.a
+	- $(RM) libumfpack.la
 
 clean:
 	- $(RM) $(CLEAN)
--- SuiteSparse/UMFPACK/Makefile.orig	2014-03-21 20:16:26.000000000 +0100
+++ SuiteSparse/UMFPACK/Makefile	2023-01-08 18:24:56.314736792 +0100
@@ -67,14 +67,12 @@ cov: purge
 
 # install UMFPACK
 install:
-	$(CP) Lib/libumfpack.a $(INSTALL_LIB)/libumfpack.$(VERSION).a
-	( cd $(INSTALL_LIB) ; ln -sf libumfpack.$(VERSION).a libumfpack.a )
-	$(CP) Include/*.h $(INSTALL_INCLUDE)
-	chmod 644 $(INSTALL_LIB)/libumfpack*.a
-	chmod 644 $(INSTALL_INCLUDE)/umfpack*.h
+	$(MAKE) -C Lib install
+	$(CP) Include/*.h $(DESTDIR)$(INSTALL_INCLUDE)
+	chmod 644 $(DESTDIR)$(INSTALL_INCLUDE)/umfpack*.h
 
 # uninstall UMFPACK
 uninstall:
-	$(RM) $(INSTALL_LIB)/libumfpack*.a
-	$(RM) $(INSTALL_INCLUDE)/umfpack*.h
+	$(RM) $(DESTDIR)$(INSTALL_LIB)/libumfpack.la
+	$(RM) $(DESTDIR)$(INSTALL_INCLUDE)/umfpack*.h
 
--- SuiteSparse/Makefile.orig	2023-01-08 15:16:06.792780747 +0100
+++ SuiteSparse/Makefile	2023-01-08 15:31:18.964505755 +0100
@@ -10,12 +10,12 @@ default:
 	( cd AMD && $(MAKE) )
 	( cd CAMD && $(MAKE) )
 	( cd COLAMD && $(MAKE) )
+	( cd CCOLAMD && $(MAKE) )
+	( cd CHOLMOD && $(MAKE) )
+	( cd UMFPACK && $(MAKE) )
 	( cd BTF && $(MAKE) )
 	( cd KLU && $(MAKE) )
 	( cd LDL && $(MAKE) )
-	( cd CCOLAMD && $(MAKE) )
-	( cd UMFPACK && $(MAKE) )
-	( cd CHOLMOD && $(MAKE) )
 	( cd CSparse && $(MAKE) )
 	( cd CXSparse && $(MAKE) )
 	( cd RBio && $(MAKE) )
